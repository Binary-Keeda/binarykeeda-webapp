import{c as O,e as U,r as i,b as D,j as e,f as J,a as _,B as $}from"./index-b2tHD9Pr.js";import{B as g}from"./Button-CmAR0m5y.js";import{M as P}from"./Modal-C9gLyWjy.js";import{B as R}from"./Box-DVW9hoM4.js";import{T as C}from"./Typography-3jmitFJ3.js";import"./DefaultPropsProvider-CDurVPpn.js";import"./extends-CF3RwP-h.js";import"./createSimplePaletteValueFilter-COr2uZoU.js";import"./CircularProgress-BY1vwNiq.js";import"./ButtonBase-DAu797o-.js";import"./objectWithoutPropertiesLoose-Dsqj8S3w.js";import"./useForkRef-B5zYVBaY.js";import"./useEnhancedEffect-SpzInZsn.js";import"./Portal-DAxSttRd.js";import"./useTheme-KZ81bX-h.js";import"./index-DI8dVHa-.js";import"./useSlot-BwXLCkxQ.js";import"./index-P7-J1HVV.js";const de=()=>{var y;const{user:c}=O(s=>s.auth),{id:l}=U(),[a,k]=i.useState(null),[h,I]=i.useState(),[j,E]=i.useState(null),[f,M]=i.useState([]),[d,w]=i.useState({}),[b,N]=i.useState(new Set),[q,p]=i.useState(!1),[z,v]=i.useState(!1),T=D(),A=(s,t)=>{w(n=>({...n,[s]:t}))},[o,m]=i.useState(0),r=a==null?void 0:a.questions[o],B=s=>{var S;const t=((S=f[o])==null?void 0:S._id)===s,n=d[s],u=b.has(s);let x="p-2 border text-sm";return t?`${x} bg-sky-600 text-white border-blue-700`:n?`${x} bg-[#7ccb40] border-green-400 text-green-800`:u?`${x} bg-orange-100 border-orange-400 text-orange-800`:`${x} bg-[#c54325] border-red-400 text-red-800`};i.useEffect(()=>{if(a&&h){const t=new Date(h.createdAt).getTime()+a.duration*60*1e3,n=setInterval(()=>{const u=t-Date.now();E(Math.max(u,0)),u<=0&&clearInterval(n)},1e3);return()=>clearInterval(n)}},[a,h]),i.useEffect(()=>{r!=null&&r._id&&N(s=>new Set(s).add(r._id))},[o,r]),i.useEffect(()=>{const s=localStorage.getItem(`solution-${l}`);if(s){const t=JSON.parse(s);w(t.answers||{}),N(new Set(t.visited||[])),m(t.currentIndex)}V({quizId:l,userId:c._id}).then(t=>{k(t.quiz),I(t.solution),M(t.quiz.questions)}).catch(t=>{})},[]),i.useEffect(()=>{a&&localStorage.setItem(`solution-${l}`,JSON.stringify({answers:d,visited:Array.from(b),currentIndex:o}))},[d,b]);const L=async()=>{v(!0);try{const s=await _.post(`${$}/api/v1/solution/user/submit`,{quizId:l,userId:c._id,response:d});localStorage.removeItem(`solution-${l}`),T("/user/results")}catch(s){console.error(s)}finally{v(!1)}};return a?e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"flex gap-8 relative h-[60px] items-center left-0 shadow-sm w-full p-4",children:e.jsxs("nav",{className:"flex gap-8 fixed h-[60px] z-20 justify-between bg-white left-0 top-0 items-center shadow-sm w-full p-4",children:[e.jsx("img",{src:J,className:"h-10",alt:""}),Math.floor(j/6e4),"m |"," ",Math.floor(j%6e4/1e3)," s"]})}),e.jsxs("main",{className:"flex flex-col h-[calc(100vh-60px)] lg:flex-row font-sans bg-white text-gray-800",children:[e.jsxs("section",{className:"flex-1 flex-col justify-between flex h-full p-5",children:[e.jsxs("div",{className:"border w-full border-gray-200 rounded-sm p-8 shadow-sm",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("p",{className:"text-base",children:["Q",o+1+".  ",r==null?void 0:r.question]})}),e.jsx("div",{className:"space-y-4",children:(y=r==null?void 0:r.options)==null?void 0:y.map((s,t)=>{const n=d[r==null?void 0:r._id]==s._id||!1;return e.jsxs("label",{className:`flex items-center border p-3 rounded-md cursor-pointer transition ${n?"border-blue-600 bg-blue-50":"border-gray-300"}`,children:[e.jsx("input",{type:"radio",className:"mr-3",name:`question-${r._id}`,value:s._id,checked:n,onChange:()=>A(r._id,s._id)}),e.jsx("span",{className:"text-sm",children:s.text})]},s._id)})})]}),e.jsxs("div",{className:"mt-8 justify-end flex items-center gap-4",children:[e.jsx("button",{onClick:()=>m(s=>Math.max(s-1,0)),disabled:o===0,className:"px-4 py-2 border rounded-md text-sm bg-[#1876d2] text-white disabled:opacity-50",children:"Previous"}),e.jsx("button",{onClick:()=>m(s=>Math.min(s+1,f.length-1)),disabled:o===f.length-1,className:"px-4 py-2 border rounded-md text-sm bg-[#1876d2] text-white disabled:opacity-50",children:"Next"})]})]}),e.jsx("section",{className:"w-full h-full lg:w-1/4 border-t lg:border-t-0 lg:border-l border-gray-200 p-6 bg-white flex flex-col justify-between",children:e.jsxs("div",{className:"w-full h-full flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold mb-4",children:"Question Navigator"}),e.jsx("div",{className:"grid grid-cols-6 gap-2 lg:grid-cols-5",children:a==null?void 0:a.questions.map((s,t)=>e.jsx("button",{onClick:()=>m(t),className:`${B(s._id)} rounded-full h-[40px] w-[40px]`,children:t+1},s._id))}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Color Legend"}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 rounded-sm bg-blue-700 inline-block"}),e.jsx("span",{children:"Current Question"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 rounded-sm bg-green-100 border border-green-400 inline-block"}),e.jsx("span",{children:"Attempted"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 rounded-sm bg-orange-100 border border-orange-400 inline-block"}),e.jsx("span",{children:"Seen but Unattempted"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 rounded-sm bg-red-100 border border-red-400 inline-block"}),e.jsx("span",{children:"Unseen"})]})]})]})]}),e.jsx(g,{onClick:()=>p(!0),variant:"contained",color:"primary",fullWidth:!0,disabled:z,children:"Submit"})]})})]}),e.jsx(P,{open:q,onClose:()=>p(!1),"aria-labelledby":"submit-confirm-title","aria-describedby":"submit-confirm-description",children:e.jsxs(R,{className:"absolute bg-white p-6 rounded-md shadow-lg",sx:{top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:600},children:[e.jsx(C,{id:"submit-confirm-title",variant:"h6",component:"h2",className:"mb-4",children:"Confirm Submission"}),e.jsx(C,{id:"submit-confirm-description",className:"mb-4 text-sm text-gray-700",children:"Are you sure you want to submit your quiz? You won't be able to change your answers later."}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(g,{onClick:()=>p(!1),variant:"outlined",children:"Cancel"}),e.jsx(g,{onClick:L,variant:"contained",color:"primary",children:"Confirm"})]})]})})]}):e.jsx("div",{className:"h-screen w-screen ",children:e.jsx("div",{className:"loader1"})})},V=async({quizId:c,userId:l})=>{try{return(await _.get(`${$}/api/v1/quiz/solution/${c}?userId=${l}`)).data}catch{return new Error("Error fetching quiz")}};export{de as default};

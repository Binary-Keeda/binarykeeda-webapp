import{j as e,r as x,a as T,B as F,c as G,e as te,C as Y,n as D,y as ae,L as V}from"./index-a66Mao4p.js";import{B as A}from"./Button-DM402-6j.js";import{M as ne}from"./Modal-CFFLBQFa.js";import{B as ie}from"./Box-DH51N0xp.js";import{T as q}from"./Typography-Bd9GSiT8.js";import{d as le}from"./index-87zNOnml.js";import{I as X}from"./IconButton-sLcLivpJ.js";import{C as Z}from"./Close-QTee2Puc.js";import{c as ee}from"./createSvgIcon-CLhJURNw.js";import{N as re,L as oe}from"./NavigateNext-DeZuC_g_.js";import{C as ce}from"./CircularProgress-DObnk1YR.js";import{D as de}from"./Divider-Byd0ob2_.js";import{S as me}from"./ShortText-okZ7xaoz.js";import"./Portal-CR2ORYs1.js";import"./index-DJSZEvvL.js";import"./dividerClasses-B7YBHfIL.js";const se=ee(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),xe=ee(e.jsx("path",{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"}),"NavigateBefore");function ue({questionSet:t=[],sectionId:a,testSubmissionId:u}){var d;const[s,h]=x.useState(0),[l,o]=x.useState({}),[f,w]=x.useState(!1),[b,m]=x.useState(!1),r=t[s],S=(n,i)=>{o(c=>({...c,[n]:i}))},y=n=>{var j;const i=((j=t[s])==null?void 0:j._id)===n,c=l[n];return`px-3 py-1 border text-sm rounded-sm ${i?"bg-blue-700 text-white border-blue-700":c?"bg-blue-100 border-blue-300 text-blue-800":"bg-gray-100 border-gray-300 text-gray-700"}`},v=()=>{w(!0),T.post(`${F}/api/v2/test/submit-section/${u}`,{sectionId:a,sectionType:"Quiz",quizAnswers:l},{withCredentials:!0}).then(()=>{m(!1),window.location.reload()}).catch(n=>{console.log(n),w(!1)})};return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-52px-70px)] lg:flex-row font-sans bg-white text-gray-800",children:[e.jsxs("div",{className:"flex-1 flex-col justify-between flex h-full p-5",children:[e.jsxs("div",{className:"border w-full border-gray-200 rounded-sm p-8 shadow-sm",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-2",children:["Question ",s+1," of ",t.length]}),e.jsx("p",{className:"text-base",children:r==null?void 0:r.question})]}),e.jsx("div",{className:"space-y-4",children:(d=r==null?void 0:r.answerOptions)==null?void 0:d.map(n=>{const i=l[r._id]===n._id;return e.jsxs("label",{className:`flex items-center border p-3 rounded-md cursor-pointer transition ${i?"border-blue-600 bg-blue-50":"border-gray-300"}`,children:[e.jsx("input",{type:"radio",className:"mr-3",name:`question-${r._id}`,value:n._id,checked:i,onChange:()=>S(r._id,n._id)}),e.jsx("span",{className:"text-sm",children:n.text})]},n._id)})})]}),e.jsxs("div",{className:"mt-8 justify-end flex items-center gap-4",children:[e.jsx("button",{onClick:()=>h(n=>Math.max(n-1,0)),disabled:s===0,className:"px-4 py-2 border rounded-md text-sm bg-white text-gray-700 hover:bg-gray-100 disabled:opacity-50",children:"Previous"}),e.jsx("button",{onClick:()=>h(n=>Math.min(n+1,t.length-1)),disabled:s===t.length-1,className:"px-4 py-2 border rounded-md text-sm bg-white text-gray-700 hover:bg-gray-100 disabled:opacity-50",children:"Next"})]})]}),e.jsx("div",{className:"w-full h-full lg:w-1/4 border-t lg:border-t-0 lg:border-l border-gray-200 p-6 bg-white flex flex-col justify-between",children:e.jsxs("div",{className:"w-full h-full flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold mb-4",children:"Question Navigator"}),e.jsx("div",{className:"grid grid-cols-5 gap-2 lg:grid-cols-3",children:t.map((n,i)=>e.jsx("button",{onClick:()=>h(i),className:y(n._id),children:i+1},n._id))}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-semibold mb-1",children:"Quiz Instructions"}),e.jsxs("ul",{className:"text-sm text-gray-700 list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Select the correct option for each question."}),e.jsx("li",{children:"You can navigate through questions using the buttons."}),e.jsx("li",{children:`Click "Submit" when you're ready. You can't change answers afterward.`})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Color Legend"}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 rounded-sm bg-blue-700 inline-block"}),e.jsx("span",{children:"Current Question"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 rounded-sm bg-blue-100 border border-blue-300 inline-block"}),e.jsx("span",{children:"Answered"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 rounded-sm bg-gray-100 border border-gray-300 inline-block"}),e.jsx("span",{children:"Unanswered"})]})]})]})]}),e.jsx(A,{onClick:()=>m(!0),variant:"contained",color:"primary",fullWidth:!0,disabled:f,children:"Submit"})]})}),e.jsx(ne,{open:b,onClose:()=>m(!1),"aria-labelledby":"submit-confirm-title","aria-describedby":"submit-confirm-description",children:e.jsxs(ie,{className:"absolute bg-white p-6 rounded-md shadow-lg",sx:{top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:300},children:[e.jsx(q,{id:"submit-confirm-title",variant:"h6",component:"h2",className:"mb-4",children:"Confirm Submission"}),e.jsx(q,{id:"submit-confirm-description",className:"mb-4 text-sm text-gray-700",children:"Are you sure you want to submit your quiz? You won't be able to change your answers later."}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(A,{onClick:()=>m(!1),variant:"outlined",children:"Cancel"}),e.jsx(A,{onClick:v,variant:"contained",color:"primary",children:"Confirm"})]})]})})]})}const he=({setShowSubmitWindow:t,setCurrProblem:a,setSubmittedProblems:u,problemName:s,code:h,currProblem:l,testCases:o,language:f,fetchResult:w,problemId:b,getLanguageId:m})=>{const[r,S]=x.useState(null),[y,v]=x.useState(!1),[d,n]=x.useState(!1),[i,c]=x.useState([]),{user:j}=G(p=>p.auth),{id:I}=te(),k=async()=>{var N;n(!0);const p=[];let C=0,z=0,L=0;for(const _ of o)try{const B=(await T.post(`${Y}/submissions?base64_encoded=false`,{source_code:h,language_id:m(f),stdin:_.input,cpu_time_limit:5,memory_limit:128e3},{headers:D})).data.token,E=await w(B),J=((N=E==null?void 0:E.stdout)==null?void 0:N.trim())||"",U=_.output.trim(),Q=J===U;Q&&C++,z+=parseFloat(E.time||0),L+=parseInt(E.memory||0),p.push({input:_.input,output:J,expected:U,passed:Q,error:E.stderr||null})}catch(M){console.error("Test case error:",M),p.push({input:_.input,output:"",expected:_.output,passed:!1,error:"Execution failed"})}const P=z/o.length,g=L/o.length;try{const _=await T.post(`${F}/api/v3/review/submit`,{userId:j._id,testId:I,problemId:l._id,language:f,sourceCode:h,codeReview:r,passedTestCases:C,totalTestCases:o.length,executionTime:P,memoryUsed:g,problemId:b});u(M=>[...M,{pNo:l,id:_.data.submissionId}]),setCurrP}catch(_){console.error("Submission API error:",_)}c(p),n(!1)},R=()=>{v(!0),T.post(`${F}/api/v3/review/code`,{sourceCode:h,problem:s}).then(p=>{const C=O(p.data.data);console.log(C),S(C)}).catch(p=>console.error(p)).finally(()=>v(!1))};function O(p){if(!p)return null;const C=p.replace(/```json\n?/,"").replace(/```$/,"");try{return JSON.parse(C)}catch(z){return console.error("Failed to parse cleaned JSON:",z),null}}x.useEffect(()=>{r?k():R()},[r]);const $=(p,C,z=6)=>{const L=C>=1;return e.jsxs("div",{className:`flex justify-between items-center px-4 py-2 rounded text-sm font-medium ${L?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[e.jsx("span",{children:p}),e.jsxs("span",{children:[C," ",L?"Passed":"Failed"]})]})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 overflow-auto",children:e.jsxs("div",{className:"bg-white relative text-black p-6 rounded-xl shadow-2xl w-[90%] max-w-3xl max-h-[90vh] overflow-y-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Code Submission Report"}),e.jsx(X,{onClick:()=>t(!1),size:"small",children:e.jsx(Z,{})})]}),y||d?e.jsx("div",{className:"flex justify-center py-6",children:e.jsx("div",{className:"loader3"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Test Case Results"}),i.map((p,C)=>e.jsxs("div",{className:`border-l-4 p-4 rounded shadow-sm ${p.passed?"border-green-500 bg-green-50":"border-red-500 bg-red-50"}`,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Input:"})," ",e.jsx("pre",{className:"inline",children:p.input})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Expected:"})," ",e.jsx("pre",{className:"inline",children:p.expected})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Your Output:"})," ",e.jsx("pre",{className:"inline",children:p.output})]}),e.jsxs("p",{className:"mt-1 text-sm font-semibold",children:["Result: ",p.passed?e.jsx("span",{className:"text-green-700",children:"✅ Passed"}):e.jsx("span",{className:"text-red-700",children:"❌ Failed"})]}),p.error&&e.jsxs("p",{className:"text-xs text-red-500 mt-1",children:["Error: ",p.error]})]},C))]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Gemini Code Review"}),r?e.jsxs("div",{className:"space-y-2",children:[$("Indentation",r.indentation),$("Modularity",r.modularity),$("Variable Naming",r.variable_name_convention),$("Time Complexity",r.time_complexity),$("Space Complexity",r.space_complexity),$("Final",r.finalScore)]}):e.jsx("div",{className:"text-gray-500 text-sm",children:"Code review not available."})]})]})]})})};function pe({setShowOutputWindow:t,codeReview:a,testResults:u,summary:s,isExecuting:h}){const l=(o,f,w=6)=>{const b=f>=1;return e.jsxs("div",{className:`flex justify-between items-center px-4 py-2 rounded text-sm font-medium ${b?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[e.jsx("span",{children:o}),e.jsx("span",{children:b?"Passed":"Failed"})]})};return e.jsx("div",{className:"absolute w-full left-0",children:e.jsxs("div",{className:"bg-white min-h-[calc(100vh-52px-60px)] relative text-black p-6 rounded-3xl shadow-2xl w-[100%] max-w-3xl max-h-[90vh] overflow-y-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Output Window"}),e.jsx(X,{onClick:()=>t(!1),size:"small",children:e.jsx(Z,{})})]}),h||u.length==0?e.jsx("div",{className:"flex justify-center py-6",children:e.jsx("div",{className:"h-full w-full flex justify-center pt-5",children:e.jsx("div",{className:"spinner"})})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Test Case Results"," ",e.jsxs("span",{className:"text-sm font-normal text-gray-600",children:["(",s==null?void 0:s.passed,"/",parseInt(s==null?void 0:s.passed)+parseInt(s==null?void 0:s.failed)," Passed)"]})]}),u.slice(0,2).map((o,f)=>e.jsxs("div",{className:`border-l-4 p-4 rounded shadow-sm ${o.passed?"border-green-500 bg-green-50":"border-red-500 bg-red-50"}`,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Input:"})," ",e.jsx("pre",{className:"inline",children:o.input})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Expected:"})," ",e.jsx("pre",{className:"inline",children:o.expected})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Your Output:"})," ",e.jsx("pre",{className:"inline",children:o.output})]}),e.jsxs("p",{className:"mt-1 text-sm font-semibold",children:["Result:"," ",o.passed?e.jsx("span",{className:"text-green-700",children:"✅ Passed"}):e.jsx("span",{className:"text-red-700",children:"❌ Failed"})]}),o.error&&e.jsxs("p",{className:"text-xs text-red-500 mt-1",children:["Error: ",o.error]})]},f)),u.length>2&&e.jsx("div",{className:"text-sm text-gray-500 italic",children:"Only first 2 test cases are shown."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"AI Code Review"}),a?e.jsxs("div",{className:"space-y-2",children:[l("Indentation",a.indentation),l("Modularity",a.modularity),l("Variable Naming",a.variable_name_convention),l("Time Complexity",a.time_complexity),l("Space Complexity",a.space_complexity),l("Final",a.finalScore)]}):e.jsx("div",{className:"text-gray-500 text-sm",children:"Code review not available."})]})]})]})})}const H=t=>typeof t=="string"?btoa(unescape(encodeURIComponent(t))):"",W=t=>typeof t=="string"?decodeURIComponent(escape(atob(t))):"",ge=async({code:t,language:a,testCases:u,setIsExecuting:s,setSummary:h,setTestResults:l,headers:o,CODE_EXECUTION_API:f,getLanguageId:w})=>{s(!0);const b=[];let m=0,r=0,S=0;try{const y=u.map(i=>({source_code:H(t),language_id:w(a),stdin:H(i.input),cpu_time_limit:5,memory_limit:128e3})),d=(await T.post(`${f}/submissions/batch?base64_encoded=true&wait=false`,{submissions:y},{headers:o})).data||[];(await fe(d,f,o)).forEach((i,c)=>{const j=u[c],I=i.stdout,k=j.output.trim(),R=I===k,O=i.stderr||i.compile_error||"";R&&m++,r+=parseFloat(i.time||0),S+=parseInt(i.memory||0),b.push({input:j.input,output:I,expected:k,passed:R,error:O})}),h({passed:m,failed:u.length-m}),l(b)}catch(y){console.error("Batch execution error:",y)}finally{s(!1)}},fe=async(t,a,u)=>{const l=t.map(o=>typeof o=="string"?o:o.token);for(let o=0;o<10;o++)try{const w=(await T.get(`${a}/submissions/batch?tokens=${l.join(",")}&base64_encoded=true`,{headers:u})).data.submissions;if(w.every(m=>{var r;return[3,4,6,11].includes((r=m.status)==null?void 0:r.id)}))return w.map(m=>({stdout:m.stdout?W(m.stdout).trim():"",stderr:m.stderr?W(m.stderr).trim():"",compile_error:m.compile_output?W(m.compile_output).trim():"",time:m.time||"0",memory:m.memory||"0",status:m.status}));await new Promise(m=>setTimeout(m,2e3))}catch(f){return console.error("Batch fetch error:",f),l.map(()=>({stdout:"",stderr:"Failed to fetch result.",compile_error:"",time:"0",memory:"0",status:{id:-1,description:"Fetch error"}}))}return l.map(()=>({stdout:"",stderr:"Timed out.",compile_error:"",time:"0",memory:"0",status:{id:-2,description:"Timed out"}}))};function be(t){if(!t)return null;const a=t.replace(/```json\n?/,"").replace(/```$/,"");try{return JSON.parse(a)}catch(u){return console.error("Failed to parse cleaned JSON:",u),null}}const je=({code:t,setCodeReview:a,problemName:u})=>{T.post(`${F}/api/v3/review/code`,{sourceCode:t,problem:u}).then(s=>{const h=be(s.data.data);return a(h),h}).catch(s=>console.error(s)).finally(()=>setLoading(!1))},K=t=>({cpp:54,c:50,java:62,python:71})[t]||71;function ye({setCurrProblem:t,currProblem:a,submittedProblems:u,problem:s,currSetting:h,setCurrentSection:l,setSubmittedProblems:o,handleCodeChange:f,handleLanguageChange:w}){const[b,m]=x.useState(h[a].language),[r,S]=x.useState(h[a].code),[y,v]=x.useState(!1),[d,n]=x.useState(),[i,c]=x.useState([]),[j,I]=x.useState(!1),[k,R]=x.useState(!1),[O,$]=x.useState();x.useEffect(()=>(u.includes(a)?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[a,u]),x.useEffect(()=>{const g=h[a];m(g.language),S(g.code)},[a,h]);const p=g=>{S(g),f(a,g)},C=g=>{const N=g.target.value;window.confirm("Changing the language might reset your code. Proceed?")&&(m(N),w(a,N))},z=async g=>{var N;for(let _=0;_<10;_++)try{const B=(await T.get(`${Y}/submissions/${g}?base64_encoded=false`,{headers:D})).data;if([3,4,6,11].includes((N=B.status)==null?void 0:N.id))return B;await new Promise(E=>setTimeout(E,2e3))}catch{return{stderr:"Failed to fetch result."}}return{stderr:"Timed out."}},L=async()=>{R(!0),c([]),await ge({code:r,language:b,testCases:s.testCases,setIsExecuting:v,setSummary:n,setTestResults:c,headers:D,CODE_EXECUTION_API:Y,getLanguageId:K}),await je({setCodeReview:$,code:r,problemName:s.title})};x.useEffect(()=>{i.length>0},[i,d]);const P=()=>{s.id,I(!1),window.confirm("Are you sure you want to submit the code?")&&(window.scrollTo({top:0,behavior:"smooth"}),I(!0))};return s?e.jsx(e.Fragment,{children:e.jsxs("section",{className:"p-5  h-[calc(100vh-60px-52px)]  overflow-x-hidden overflow-y-hidden left-0  relative flex w-[calc(100vw-70px)]",children:[e.jsxs("div",{className:"flex-[0.6] relative min-w-[200px] custom-scrollbar overflow-y-hidden",children:[e.jsxs("div",{className:"flex-[0.4] overflow-y-scroll h-full p-4 space-y-4 text-sm",children:[e.jsx("h1",{className:"text-2xl font-bold",children:s.title}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Description"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-line",children:s.description})]}),s.constraints&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Constraints"}),e.jsx("ul",{className:"list-disc list-inside text-gray-600",children:s.constraints.map((g,N)=>e.jsx("li",{children:g},N))})]}),s.topics&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Topics"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.topics.map((g,N)=>e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded",children:g},N))})]}),s.hints&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Hints"}),e.jsx("ul",{className:"list-disc list-inside text-gray-600",children:s.hints.map((g,N)=>e.jsx("li",{children:g},N))})]}),s.sampleTestCases&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Sample Test Cases"}),s.sampleTestCases.map((g,N)=>e.jsxs("div",{className:"mb-2 p-2 bg-gray-100 rounded",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Input:"})," ",g.input]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Output:"})," ",g.output]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Explanation:"})," ",g.explanation]})]},N))]})]}),e.jsxs("div",{className:`absolute w-full h-[] top-0 transition-all duration-300 ease-linear  ${k?"top-0":"top-[100vh] invisible "}`,children:[j&&e.jsx(he,{setCurrProblem:t,problemName:s.title,problemId:s._id,setShowSubmitWindow:I,code:r,language:b,testCases:s.testCases,getLanguageId:K,fetchResult:z,currProblem:a,setSubmittedProblems:o}),k&&e.jsx(e.Fragment,{children:e.jsx(pe,{codeReview:O,setShowOutputWindow:R,testResults:i,summary:d})})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("hr",{className:"bg-gray-300  flex-1 w-[2px]"}),e.jsxs("div",{className:"hover:bg-blue-500 hover:text-white cursor-grab bg-gray-300 h-[25px] w-[25px] flex items-center  rounded-full",children:[e.jsx(xe,{sx:{marginRight:"-3px"},fontSize:"12"}),e.jsx(re,{sx:{marginLeft:"-3px"},fontSize:"12"})]}),e.jsx("hr",{className:"bg-gray-300 flex-1 w-[2px]"})]}),e.jsxs("div",{className:"mb-10 relative flex-1",children:[u.some(g=>g.pNo===a)&&e.jsx("div",{className:"absolute h-full w-full inset-0  bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-10",children:e.jsxs("div",{className:"bg-white text-black p-6 rounded shadow-lg text-center",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Submission Notice"}),e.jsx("p",{children:"You have already submitted this problem."})]})}),e.jsxs("div",{className:"bg-gray-50 flex justify-between p-5 mx-5 rounded-t-lg",children:[e.jsxs("div",{className:"flex flex-col  ml-1",children:[e.jsx("label",{className:"text-xs mb-1",children:"Choose language"}),e.jsxs("select",{value:b,onChange:C,className:"custominput",children:[e.jsx("option",{value:"cpp",children:"C++"}),e.jsx("option",{value:"c",children:"C"}),e.jsx("option",{value:"java",children:"Java"}),e.jsx("option",{value:"python",children:"Python"})]})]}),e.jsxs("div",{className:"flex justify-end flex-1 items-center gap-2",children:[e.jsx("button",{onClick:L,className:"rounded-md border border-slate-300 py-2 px-4 text-sm transition-all shadow-sm hover:shadow-lg text-white bg-slate-800 disabled:opacity-50",type:"button",disabled:y,children:y?"Running...":"Run Code"}),e.jsx("button",{onClick:P,className:"rounded-md border border-slate-300 py-2 px-4 text-sm transition-all shadow-sm hover:shadow-lg text-white bg-slate-800",type:"button",children:"Submit"})]})]}),e.jsx("div",{className:"bg-gray-50 shadow-lg border mx-5 custom-scrollbar",children:e.jsx(le,{height:"550px",language:b,value:r,onChange:p,options:{theme:"light",minimap:{enabled:!1},fontSize:14}})})]})]})}):e.jsx("p",{className:"p-5 text-red-500",children:"Problem not found"})}function ve({test:t,currSection:a,testSubmission:u}){const[s,h]=x.useState(0),[l,o]=x.useState([]),{user:f}=G(d=>d.auth),[w,b]=x.useState(),[m,r]=x.useState(()=>t.sections[a].problemset.map((d,n)=>{var i;return{id:n,language:"cpp",code:((i=d.functionSignature.find(c=>c.language==="cpp"))==null?void 0:i.signature)||""}}));x.useEffect(()=>{(async()=>{try{const i=(await Promise.all(t==null?void 0:t.sections[a].problemset.map(c=>T.get(`${F}/api/v2/test/get/problem/response`,{params:{userId:f._id,problemId:c._id,testId:t._id},withCredentials:!0})))).map((c,j)=>c.data.exists?{pNo:j,id:c.data.id}:null).filter(c=>c!==null);o(i)}catch(n){console.error("Error fetching submissions:",n)}})()},[a,t._id,f._id,t==null?void 0:t.sections]),x.useEffect(()=>{r(d=>t.sections[a].problemset.map((n,i)=>{var c;return d[i]||{id:i,language:"cpp",code:((c=n.functionSignature.find(j=>j.language==="cpp"))==null?void 0:c.signature)||""}}))},[a,t.sections]);const S=(d,n)=>{r(i=>{const c=[...i];return c[d]={...c[d],code:n},c})},y=(d,n)=>{r(i=>{const c=[...i],j=c[d],I=t.sections[a].problemset[d].functionSignature.find(k=>k.language===n);return c[d]={...j,language:n,code:(I==null?void 0:I.signature)||""},c})},v=async()=>{try{b(!0),await T.post(`${F}/api/v2/test/submit-section/${u._id}`,{sectionId:t.sections[a]._id,sectionType:t.sections[a].sectionType,codingAnswers:l},{withCredentials:!0}),window.location.reload()}catch(d){console.error("Submit error:",d)}finally{b(!1)}};return x.useEffect(()=>{l.length==t.sections[a].problemset.length&&v()},[l]),e.jsxs(e.Fragment,{children:[l.length===t.sections[a].problemset.length&&e.jsx("div",{className:"fixed top-[67px]  flex w-full justify-end pr-24",children:e.jsx(A,{disabled:w,onClick:v,variant:"contained",sx:{bgcolor:"#000"},children:w?e.jsx(ce,{size:14}):"Submit"})}),e.jsx("div",{className:"fixed right-0 top-[70px] h-[calc(100vh-70px)] px-5 py-4 bg-gray-50 shadow-sm rounded-md mb-4",children:e.jsxs("div",{className:"relative flex flex-col items-center gap-6",children:[e.jsx("div",{className:"absolute top-0 bottom-0 left-1/2 w-[2px] bg-gray-400 z-0"}),t.sections[a].problemset.map((d,n)=>{const i=l.some(j=>(j==null?void 0:j.pNo)===n),c=n===s;return e.jsx("span",{onClick:()=>{i||h(n)},disabled:i,className:`relative border-gray-300 border-2 z-10 flex justify-center items-center h-[35px] w-[35px] rounded-full text-sm font-medium transition duration-200
            ${i?"bg-blue-500 text-white border-green-600 cursor-not-allowed":c?"bg-blue-500  text-white cursor-pointer shadow-md":"bg-gray-100 text-gray-800 cursor-pointer hover:bg-gray-200 border-gray-300"}
          `,title:i?"Already submitted":"Click to open",children:i?e.jsx(se,{fontSize:"small",className:"text-blue-400"}):n+1},n)})]})}),s<t.sections[a].problemset.length&&e.jsx(ye,{setCurrProblem:h,currProblem:s,submittedProblems:l,problem:t.sections[a].problemset[s],currSetting:m,setSubmittedProblems:o,setCurrentSection:r,handleCodeChange:S,handleLanguageChange:y})]})}function Ae({userId:t,testSubmission:a,testId:u,currSection:s,setCurrentSection:h,test:l}){var S;const[o,f]=x.useState(0),{user:w}=G(y=>y.auth),[b,m]=x.useState(!1);x.useEffect(()=>{if(l&&a){const v=new Date(a.startedAt).getTime()+l.duration*60*1e3,d=setInterval(()=>{const n=v-Date.now();f(Math.max(n,0)),n<=0&&(clearInterval(d),r())},1e3);return()=>clearInterval(d)}},[a,l]);const r=()=>{console.log("Time's up! Submitting test...")};return a.isSubmitted?e.jsx(e.Fragment,{children:e.jsx(we,{testSubmission:a})}):e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"flex gap-8 relative h-[60px] items-center left-0 shadow-sm w-full p-4",children:e.jsxs("nav",{className:"flex gap-8 fixed h-[60px] z-20 justify-between bg-white left-0 top-0 items-center shadow-sm w-full p-4",children:[e.jsx("div",{className:"flex items-center gap-5",children:e.jsx("img",{src:ae,className:"h-9",alt:"Logo"})}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("p",{children:"Time left"}),o>0?e.jsxs("div",{className:"flex gap-4 items-center px-3 p-1 bg-gray-300 text-gray-900 rounded-sm shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2 text-md ",children:[e.jsx("span",{className:"text-lg animate-pulse"}),Math.floor(o/6e4)," m"]}),e.jsx(de,{orientation:"vertical",flexItem:!0,className:"border-gray-300"}),e.jsxs("div",{className:"flex items-center gap-2 text-md ",children:[e.jsx("span",{className:"text-lg animate-pulse",children:" "}),Math.floor(o%6e4/1e3)," s"]})]}):e.jsx("span",{className:"text-red-500 font-bold",children:"Loading...."}),e.jsx("div",{className:"cursor-pointer",children:e.jsx(me,{})})]})]})}),e.jsx("div",{className:"flex px-3 py-2 shadow-sm bg-gray-50 items-center gap-2",children:l==null?void 0:l.sections.map((y,v)=>{const d=v===s,n=v<s,i=v>s;return e.jsxs("div",{className:`w-[140px] py-2 px-3 rounded-lg shadow-sm text-sm flex justify-between items-center cursor-pointer transition duration-300
    ${d?"bg-blue-600 text-white":"bg-white hover:bg-blue-50 text-blue-800"}
  `,children:[e.jsx("span",{className:"mr-2 font-medium truncate",children:y.name}),e.jsxs("div",{className:"flex items-center gap-1",children:[n&&e.jsx(se,{fontSize:"small",className:"text-blue-400"}),i&&e.jsx(oe,{fontSize:"small",className:"text-blue-200"})]})]},v)})}),l.sections[s].sectionType=="Quiz"?e.jsx(ue,{testSubmissionId:a._id,sectionId:l.sections[s]._id,questionSet:(S=l.sections[s])==null?void 0:S.questionSet}):e.jsx(ve,{testSubmission:a,currSection:s,test:l})]})}function we({testSubmission:t}){return t!=null&&t.isSubmitted?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:e.jsxs("div",{className:"bg-white shadow-lg rounded-xl p-8 max-w-xl w-full text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-green-700 mb-4",children:"Test Submitted Successfully"}),e.jsxs("p",{className:"text-gray-700 text-base mb-6",children:["Your test response has been successfully recorded. ",e.jsx("br",{}),"You may review your answers in the ",e.jsx("span",{className:"font-medium text-blue-600",children:"Preview"})," section."]}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(V,{to:"/",children:e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-md text-sm transition-all",children:"Return to Home"})}),e.jsx(V,{to:"/user",children:e.jsx("button",{className:"bg-gray-200 hover:bg-gray-300 text-gray-800 px-5 py-2 rounded-md text-sm transition-all",children:"View Response"})})]})]})}):null}export{Ae as default};

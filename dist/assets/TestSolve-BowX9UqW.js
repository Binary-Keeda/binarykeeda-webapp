import{c as V,j as e,r as x,a as I,B as $,d as P,f as H,I as X,a8 as A,a9 as M,af as K,L as J}from"./index-f_TJ5S0E.js";import{d as Z}from"./index-CA9mC-zu.js";import{C as q}from"./Close-CCW5fcVL.js";import{B as ee}from"./Button-DYCoXFtq.js";import{D as se}from"./Divider-BW2T63mc.js";import{L as te}from"./Lock-D3hMfbiW.js";const ae=V(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle");function ne({questionSet:s=[],sectionId:d,testSubmissionId:u}){var N;const[c,w]=x.useState(0),[i,p]=x.useState({}),b=s[c],y=(r,t)=>{p(n=>({...n,[r]:t}))},v=r=>{var l;const t=((l=s[c])==null?void 0:l._id)===r,n=i[r];return`px-3 py-1 border text-sm rounded-sm ${t?"bg-blue-700 text-white border-blue-700":n?"bg-blue-100 border-blue-300 text-blue-800":"bg-gray-100 border-gray-300 text-gray-700"}`},h=()=>{const r=Object.entries(i).map(([t,n])=>({questionId:t,selectedOptionId:n}));I.post(`${$}/api/v2/test/submit-section/${u}`,{sectionId:d,sectionType:"Quiz",quizAnswers:r},{withCredentials:!0}).then(()=>{window.location.reload()}).catch(t=>console.log(t))};return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-52px-70px)] lg:flex-row font-sans bg-white text-gray-800",children:[e.jsxs("div",{className:"flex-1 flex-col justify-between flex h-full  p-10",children:[e.jsxs("div",{className:"border w-full border-gray-200 rounded-md p-8 shadow-sm",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-2",children:["Question ",c+1," of ",s.length]}),e.jsx("p",{className:"text-base",children:b==null?void 0:b.question})]}),e.jsx("div",{className:"space-y-4",children:(N=b==null?void 0:b.answerOptions)==null?void 0:N.map(r=>{const t=i[b._id]===r._id;return e.jsxs("label",{className:`flex items-center border p-3 rounded-md cursor-pointer transition ${t?"border-blue-600 bg-blue-50":"border-gray-300"}`,children:[e.jsx("input",{type:"radio",className:"mr-3",name:`question-${b._id}`,value:r._id,checked:t,onChange:()=>y(b._id,r._id)}),e.jsx("span",{className:"text-sm",children:r.text})]},r._id)})})]}),e.jsxs("div",{className:"mt-8 justify-end flex items-center gap-4",children:[e.jsx("button",{onClick:()=>w(r=>Math.max(r-1,0)),disabled:c===0,className:"px-4 py-2 border rounded-md text-sm bg-white text-gray-700 hover:bg-gray-100 disabled:opacity-50",children:"Previous"}),e.jsx("button",{onClick:()=>w(r=>Math.min(r+1,s.length-1)),disabled:c===s.length-1,className:"px-4 py-2 border rounded-md text-sm bg-white text-gray-700 hover:bg-gray-100 disabled:opacity-50",children:"Next"})]})]}),e.jsx("div",{className:"w-full h-full lg:w-1/4 border-t lg:border-t-0 lg:border-l border-gray-200 p-6 bg-white flex flex-col justify-between",children:e.jsxs("div",{className:"w-full h-full border-t  lg:border border-gray-200 p-6 bg-white flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold mb-4",children:"Question Navigator"}),e.jsx("div",{className:"grid grid-cols-5 gap-2 lg:grid-cols-3",children:s.map((r,t)=>e.jsx("button",{onClick:()=>w(t),className:v(r._id),children:t+1},r._id))})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:h,className:"w-full px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700",children:"Submit"})})]})})]})}const re=({setShowSubmitWindow:s,setSubmittedProblems:d,problemName:u,code:c,currProblem:w,testCases:i,language:p,fetchResult:b,problemId:y,getLanguageId:v})=>{const[h,N]=x.useState(null),[r,t]=x.useState(!1),[n,l]=x.useState(!1),[o,f]=x.useState([]),{user:T}=P(a=>a.auth),{id:k}=H(),R=async()=>{var D;l(!0);const a=[];let g=0,_=0,j=0;for(const C of i)try{const Q=(await I.post(`${A}/submissions?base64_encoded=false`,{source_code:c,language_id:v(p),stdin:C.input,cpu_time_limit:5,memory_limit:128e3},{headers:M})).data.token,E=await b(Q),Y=((D=E==null?void 0:E.stdout)==null?void 0:D.trim())||"",G=C.output.trim(),W=Y===G;W&&g++,_+=parseFloat(E.time||0),j+=parseInt(E.memory||0),a.push({input:C.input,output:Y,expected:G,passed:W,error:E.stderr||null})}catch(O){console.error("Test case error:",O),a.push({input:C.input,output:"",expected:C.output,passed:!1,error:"Execution failed"})}const S=_/i.length,L=j/i.length;try{const C=await I.post(`${$}/api/v3/review/submit`,{userId:T._id,testId:k,problemId:w._id,language:p,sourceCode:c,codeReview:h,passedTestCases:g,totalTestCases:i.length,executionTime:S,memoryUsed:L,problemId:y});d(O=>[...O,{pNo:w,id:C.data.submissionId}])}catch(C){console.error("Submission API error:",C)}f(a),l(!1)},z=()=>{t(!0),I.post(`${$}/api/v3/review/code`,{sourceCode:c,problem:u}).then(a=>{const g=F(a.data.data);console.log(g),N(g)}).catch(a=>console.error(a)).finally(()=>t(!1))};function F(a){if(!a)return null;const g=a.replace(/```json\n?/,"").replace(/```$/,"");try{return JSON.parse(g)}catch(_){return console.error("Failed to parse cleaned JSON:",_),null}}x.useEffect(()=>{h?R():z()},[h]);const m=(a,g,_=6)=>{const j=g>=1;return e.jsxs("div",{className:`flex justify-between items-center px-4 py-2 rounded text-sm font-medium ${j?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[e.jsx("span",{children:a}),e.jsxs("span",{children:[g," ",j?"Passed":"Failed"]})]})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 overflow-auto",children:e.jsxs("div",{className:"bg-white relative text-black p-6 rounded-xl shadow-2xl w-[90%] max-w-3xl max-h-[90vh] overflow-y-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Code Submission Report"}),e.jsx(X,{onClick:()=>s(!1),size:"small",children:e.jsx(q,{})})]}),r||n?e.jsx("div",{className:"flex justify-center py-6",children:e.jsx("div",{className:"loader3"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Test Case Results"}),o.map((a,g)=>e.jsxs("div",{className:`border-l-4 p-4 rounded shadow-sm ${a.passed?"border-green-500 bg-green-50":"border-red-500 bg-red-50"}`,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Input:"})," ",e.jsx("pre",{className:"inline",children:a.input})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Expected:"})," ",e.jsx("pre",{className:"inline",children:a.expected})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Your Output:"})," ",e.jsx("pre",{className:"inline",children:a.output})]}),e.jsxs("p",{className:"mt-1 text-sm font-semibold",children:["Result: ",a.passed?e.jsx("span",{className:"text-green-700",children:"✅ Passed"}):e.jsx("span",{className:"text-red-700",children:"❌ Failed"})]}),a.error&&e.jsxs("p",{className:"text-xs text-red-500 mt-1",children:["Error: ",a.error]})]},g))]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Gemini Code Review"}),h?e.jsxs("div",{className:"space-y-2",children:[m("Indentation",h.indentation),m("Modularity",h.modularity),m("Variable Naming",h.variable_name_convention),m("Time Complexity",h.time_complexity),m("Space Complexity",h.space_complexity),m("Final",h.finalScore)]}):e.jsx("div",{className:"text-gray-500 text-sm",children:"Code review not available."})]})]})]})})};function B(s){return s.replace(/\\n/g,`
`)}const U=s=>({cpp:54,c:50,java:62,python:71})[s]||71;function ie({currProblem:s,submittedProblems:d,problem:u,currSetting:c,setCurrentSection:w,setSubmittedProblems:i,handleCodeChange:p,handleLanguageChange:b}){const[y,v]=x.useState(c[s].language),[h,N]=x.useState(c[s].code),[r,t]=x.useState(!1),[n,l]=x.useState([]),[o,f]=x.useState();x.useEffect(()=>(d.includes(s)?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[s,d]),x.useEffect(()=>{const m=c[s];v(m.language),N(m.code),l([])},[s,c]);const T=m=>{N(m),p(s,m)},k=m=>{const a=m.target.value;window.confirm("Changing the language might reset your code. Proceed?")&&(v(a),b(s,a))},R=async m=>{var a;for(let g=0;g<10;g++)try{const j=(await I.get(`${A}/submissions/${m}?base64_encoded=false`,{headers:M})).data;if([3,4,6,11].includes((a=j.status)==null?void 0:a.id))return j;await new Promise(S=>setTimeout(S,2e3))}catch{return{stderr:"Failed to fetch result."}}return{stderr:"Timed out."}},z=async()=>{t(!0);const m=[];for(const a of u.sampleTestCases)try{const _=(await I.post(`${A}/submissions?base64_encoded=false`,{source_code:h,language_id:U(y),stdin:a.input,cpu_time_limit:5,memory_limit:128e3},{headers:M})).data.token,j=await R(_),S=j!=null&&j.stdout?j.stdout.trim():"",L=a.output.trim();m.push({input:a.input,output:S,expected:L,passed:S===L,error:j.stderr||null})}catch(g){console.error("Test case error:",g),m.push({input:a.input,output:"",expected:a.output,passed:!1,error:"Execution failed"})}l(m),t(!1)},F=()=>{u.id,window.confirm("Are you sure you want to submit the code?")&&(window.scrollTo({top:0,behavior:"smooth"}),f(!0))};return u?e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"p-5   relative flex mr-20",children:[e.jsxs("div",{className:"flex-[0.4] px-5",children:[e.jsxs("p",{className:"text-lg font-semibold",children:[e.jsx("strong",{children:"Problem:"})," ",u.title]}),e.jsxs("p",{className:"mb-4",children:[e.jsx("strong",{children:"Description:"})," ",u.description]}),e.jsxs("div",{className:"relative",children:[e.jsx("p",{className:"text-lg font-semibold mb-2",children:"Example"}),u.sampleTestCases.map((m,a)=>(n[a],e.jsxs("div",{className:"mb-6 border rounded p-4 bg-gray-50",children:[e.jsx("div",{className:"mb-2 flex justify-between items-center",children:e.jsxs("strong",{children:["Test Case #",a+1]})}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Input:"}),e.jsx("pre",{className:"bg-white p-2 border rounded whitespace-pre-wrap",children:B(m.input)})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Expected Output:"}),e.jsx("pre",{className:"bg-white p-2 border rounded whitespace-pre-wrap",children:B(m.output)})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Explanation:"}),e.jsx("p",{className:"mt-1",children:m.explanation})]})]},a)))]})]}),e.jsxs("div",{className:"mb-10 relative flex-1",children:[d.some(m=>m.pNo===s)&&e.jsx("div",{className:"absolute h-full w-full inset-0  bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-40",children:e.jsxs("div",{className:"bg-white text-black p-6 rounded shadow-lg text-center",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Submission Notice"}),e.jsx("p",{children:"You have already submitted this problem."})]})}),e.jsxs("div",{className:"bg-gray-50 flex justify-between p-5 mx-5 rounded-t-lg",children:[e.jsxs("div",{className:"flex flex-col  ml-1",children:[e.jsx("label",{className:"text-xs mb-1",children:"Choose language"}),e.jsxs("select",{value:y,onChange:k,className:"custominput",children:[e.jsx("option",{value:"cpp",children:"C++"}),e.jsx("option",{value:"c",children:"C"}),e.jsx("option",{value:"java",children:"Java"}),e.jsx("option",{value:"python",children:"Python"})]})]}),e.jsxs("div",{className:"flex justify-end flex-1 items-center gap-2",children:[e.jsx("button",{onClick:z,className:"rounded-md border border-slate-300 py-2 px-4 text-sm transition-all shadow-sm hover:shadow-lg text-white bg-slate-800 disabled:opacity-50",type:"button",disabled:r,children:r?"Running...":"Run Code"}),e.jsx("button",{onClick:F,className:"rounded-md border border-slate-300 py-2 px-4 text-sm transition-all shadow-sm hover:shadow-lg text-white bg-slate-800",type:"button",children:"Submit"})]})]}),e.jsxs("div",{className:"bg-gray-50 shadow-lg border mx-5 custom-scrollbar",children:[e.jsx(Z,{height:"500px",language:y,value:h,onChange:T,options:{theme:"light",minimap:{enabled:!1},fontSize:14}}),(r||n.length>0)&&e.jsx(le,{isExecuting:r,testResults:n,data:u==null?void 0:u.sampleTestCases})]})]})]}),o&&e.jsx(re,{problemName:u.title,problemId:u._id,setShowSubmitWindow:f,code:h,language:y,testCases:u.testCases,getLanguageId:U,fetchResult:R,currProblem:s,setSubmittedProblems:i})]}):e.jsx("p",{className:"p-5 text-red-500",children:"Problem not found"})}const le=({isExecuting:s,code:d,data:u,testResults:c})=>e.jsx("div",{className:"grid mt-5 grid-cols-4 gap-3 mx-5 w-full",children:u==null?void 0:u.map((w,i)=>{const p=c[i];return e.jsx("div",{className:"mb-6 border rounded p-4 bg-gray-50",children:s?e.jsxs("div",{className:"flex justify-center",children:[" ",e.jsx("div",{className:"loader3"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-2 flex justify- items-center",children:[e.jsxs("strong",{children:["Test Case #",i+1]}),p&&e.jsx("span",{className:`font-semibold ${p.passed?"text-green-600":"text-red-600"}`,children:p.passed?"✅ Passed":"❌ Failed"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Input:"}),e.jsx("pre",{className:"bg-white p-2 border rounded whitespace-pre-wrap",children:B(w.input)})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Expected Output:"}),e.jsx("pre",{className:"bg-white p-2 border rounded whitespace-pre-wrap",children:w.output})]}),p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Your Output:"}),e.jsx("pre",{className:"bg-white p-2 border rounded whitespace-pre-wrap",children:p.output||"No output"})]}),p.error&&e.jsxs("div",{className:"text-red-500",children:[e.jsx("strong",{children:"Error:"})," ",p.error]})]})]})},i)})});function oe({test:s,currSection:d,testSubmission:u}){const[c,w]=x.useState(0),[i,p]=x.useState([]),{user:b}=P(t=>t.auth),[y,v]=x.useState(()=>s.sections[d].problemset.map((t,n)=>{var l;return{id:n,language:"cpp",code:((l=t.functionSignature.find(o=>o.language==="cpp"))==null?void 0:l.signature)||""}}));x.useEffect(()=>{(async()=>{try{const l=(await Promise.all(s==null?void 0:s.sections[d].problemset.map(o=>I.get(`${$}/api/v2/test/get/problem/response`,{params:{userId:b._id,problemId:o._id,testId:s._id},withCredentials:!0})))).map((o,f)=>o.data.exists?{pNo:f,id:o.data.id}:null).filter(o=>o!==null);p(l)}catch(n){console.error("Error fetching submissions:",n)}})()},[d,s._id,b._id,s==null?void 0:s.sections]),x.useEffect(()=>{v(t=>s.sections[d].problemset.map((n,l)=>{var o;return t[l]||{id:l,language:"cpp",code:((o=n.functionSignature.find(f=>f.language==="cpp"))==null?void 0:o.signature)||""}}))},[d,s.sections]);const h=(t,n)=>{v(l=>{const o=[...l];return o[t]={...o[t],code:n},o})},N=(t,n)=>{v(l=>{const o=[...l],f=o[t],T=s.sections[d].problemset[t].functionSignature.find(k=>k.language===n);return o[t]={...f,language:n,code:(T==null?void 0:T.signature)||""},o})},r=async()=>{try{await I.post(`${$}/api/v2/test/submit-section/${u._id}`,{sectionId:s.sections[d]._id,sectionType:s.sections[d].sectionType,codingAnswers:i},{withCredentials:!0}),window.location.reload()}catch(t){console.error("Submit error:",t)}};return e.jsxs(e.Fragment,{children:[i.length===s.sections[d].problemset.length&&e.jsx("div",{className:"fixed top-[67px]  flex w-full justify-end pr-24",children:e.jsx(ee,{onClick:r,variant:"contained",sx:{bgcolor:"#000"},children:"Submit"})}),e.jsx("div",{className:"fixed right-0 top-[70px] h-[calc(100vh-70px)] px-5 py-4 bg-gray-50 shadow-sm rounded-md mb-4",children:e.jsxs("div",{className:"relative flex flex-col items-center gap-6",children:[e.jsx("div",{className:"absolute top-0 bottom-0 left-1/2 w-[2px] bg-gray-300 z-0"}),s.sections[d].problemset.map((t,n)=>{const l=i.some(f=>(f==null?void 0:f.pNo)===n),o=n===c;return e.jsx("span",{onClick:()=>{l||w(n)},disabled:l,className:`relative z-10 flex justify-center items-center h-[35px] w-[35px] rounded-full text-sm font-medium transition duration-200
            ${l?"bg-green-500 text-white border-green-600 cursor-not-allowed":o?"bg-orange-500 text-white shadow-md":"bg-gray-100 text-gray-800 hover:bg-gray-200 border-gray-300"}
          `,title:l?"Already submitted":"Click to open",children:n+1},n)})]})}),e.jsx(ie,{currProblem:c,submittedProblems:i,problem:s.sections[d].problemset[c],currSetting:y,setSubmittedProblems:p,setCurrentSection:v,handleCodeChange:h,handleLanguageChange:N})]})}function ge({userId:s,testSubmission:d,testId:u,currSection:c,setCurrentSection:w,test:i}){var r;const[p,b]=x.useState(0),{user:y}=P(t=>t.auth),[v,h]=x.useState(!1);x.useEffect(()=>{if(i&&d){const n=new Date(d.startedAt).getTime()+i.duration*60*1e3,l=setInterval(()=>{const o=n-Date.now();b(Math.max(o,0)),o<=0&&(clearInterval(l),N())},1e3);return()=>clearInterval(l)}},[d,i]);const N=()=>{console.log("Time's up! Submitting test...")};return d.isSubmitted?e.jsx(e.Fragment,{children:e.jsx(de,{testSubmission:d})}):e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"flex gap-8 relative h-[60px] items-center left-0 shadow-sm w-full p-4",children:e.jsxs("nav",{className:"flex gap-8 fixed h-[60px] z-20 justify-between bg-white left-0 top-0 items-center shadow-sm w-full p-4",children:[e.jsx("div",{className:"flex items-center gap-5",children:e.jsx("img",{src:K,className:"h-9",alt:"Logo"})}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("p",{children:"Time left"}),p>0?e.jsxs("div",{className:"flex gap-4 items-center px-3 p-1 bg-gray-300 text-gray-900 rounded-sm shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2 text-md ",children:[e.jsx("span",{className:"text-lg animate-pulse"}),Math.floor(p/6e4)," m"]}),e.jsx(se,{orientation:"vertical",flexItem:!0,className:"border-gray-300"}),e.jsxs("div",{className:"flex items-center gap-2 text-md ",children:[e.jsx("span",{className:"text-lg animate-pulse",children:" "}),Math.floor(p%6e4/1e3)," s"]})]}):e.jsx("span",{className:"text-red-500 font-bold",children:"Loading...."})]})]})}),e.jsx("div",{className:"flex px-3 py-2 shadow-sm bg-gray-50 items-center gap-2",children:i==null?void 0:i.sections.map((t,n)=>{const l=n===c,o=n<c,f=n>c;return e.jsxs("div",{className:`w-[140px] py-2 px-3 rounded-lg shadow-sm text-sm flex justify-between items-center cursor-pointer transition duration-300
    ${l?"bg-blue-600 text-white":"bg-white hover:bg-blue-50 text-blue-800"}
  `,children:[e.jsx("span",{className:"mr-2 font-medium truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-1",children:[o&&e.jsx(ae,{fontSize:"small",className:"text-blue-400"}),f&&e.jsx(te,{fontSize:"small",className:"text-blue-200"})]})]},n)})}),i.sections[c].sectionType=="Quiz"?e.jsx(ne,{testSubmissionId:d._id,sectionId:i.sections[c]._id,questionSet:(r=i.sections[c])==null?void 0:r.questionSet}):e.jsx(oe,{testSubmission:d,currSection:c,test:i})]})}function de({testSubmission:s}){return s!=null&&s.isSubmitted?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:e.jsxs("div",{className:"bg-white shadow-lg rounded-xl p-8 max-w-xl w-full text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-green-700 mb-4",children:"Test Submitted Successfully"}),e.jsxs("p",{className:"text-gray-700 text-base mb-6",children:["Your test response has been successfully recorded. ",e.jsx("br",{}),"You may review your answers in the ",e.jsx("span",{className:"font-medium text-blue-600",children:"Preview"})," section."]}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(J,{to:"/",children:e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-md text-sm transition-all",children:"Return to Home"})}),e.jsx(J,{to:"/user",children:e.jsx("button",{className:"bg-gray-200 hover:bg-gray-300 text-gray-800 px-5 py-2 rounded-md text-sm transition-all",children:"View Response"})})]})]})}):null}export{ge as default};

import{c as Q,j as e,r as x,a as T,B as O,d as D,f as V,I as F,a9 as M,aa as B,af as X,aB as H}from"./index-C0wR8LFk.js";import{d as K}from"./index-8C4FTgHw.js";import{C as Z}from"./Close-BHF0SOWh.js";import{B as q}from"./Button-DACB9L2s.js";import{D as ee}from"./Divider-CoGmcUdi.js";import{A as se}from"./ArrowRight-BA05axWL.js";import{L as te}from"./Lock-BS0rOr9J.js";const ne=Q(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle");function ae({questionSet:s=[],sectionId:l,testSubmissionId:u}){var N;const[m,j]=x.useState(0),[d,h]=x.useState({}),g=s[m],v=(r,n)=>{h(a=>({...a,[r]:n}))},b=r=>{var i;const n=((i=s[m])==null?void 0:i._id)===r,a=d[r];return`px-3 py-1 border text-sm rounded-sm ${n?"bg-blue-700 text-white border-blue-700":a?"bg-blue-100 border-blue-300 text-blue-800":"bg-gray-100 border-gray-300 text-gray-700"}`},w=()=>{const r=Object.entries(d).map(([n,a])=>({questionId:n,selectedOptionId:a}));T.post(`${O}/api/v2/test/submit-section/${u}`,{sectionId:l,sectionType:"Quiz",quizAnswers:r},{withCredentials:!0}).then(()=>{window.location.reload()}).catch(n=>console.log(n))};return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-70px)] lg:flex-row font-sans bg-white text-gray-800",children:[e.jsx("div",{className:"flex-1 flex h-full justify-start p-10",children:e.jsxs("div",{className:"border w-full border-gray-200 rounded-md p-8 shadow-sm",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-2",children:["Question ",m+1," of ",s.length]}),e.jsx("p",{className:"text-base",children:g==null?void 0:g.question})]}),e.jsx("div",{className:"space-y-4",children:(N=g==null?void 0:g.answerOptions)==null?void 0:N.map(r=>{const n=d[g._id]===r._id;return e.jsxs("label",{className:`flex items-center border p-3 rounded-md cursor-pointer transition ${n?"border-blue-600 bg-blue-50":"border-gray-300"}`,children:[e.jsx("input",{type:"radio",className:"mr-3",name:`question-${g._id}`,value:r._id,checked:n,onChange:()=>v(g._id,r._id)}),e.jsx("span",{className:"text-sm",children:r.text})]},r._id)})}),e.jsxs("div",{className:"mt-8 flex items-center gap-4",children:[e.jsx("button",{onClick:()=>j(r=>Math.max(r-1,0)),disabled:m===0,className:"px-4 py-2 border rounded-md text-sm bg-white text-gray-700 hover:bg-gray-100 disabled:opacity-50",children:"Previous"}),e.jsx("button",{onClick:()=>j(r=>Math.min(r+1,s.length-1)),disabled:m===s.length-1,className:"px-4 py-2 border rounded-md text-sm bg-white text-gray-700 hover:bg-gray-100 disabled:opacity-50",children:"Next"})]})]})}),e.jsxs("div",{className:"w-full h-full lg:w-1/4 border-t lg:border-t-0 lg:border-l border-gray-200 p-6 bg-gray-50 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold mb-4",children:"Question Navigator"}),e.jsx("div",{className:"grid grid-cols-5 gap-2 lg:grid-cols-3",children:s.map((r,n)=>e.jsx("button",{onClick:()=>j(n),className:b(r._id),children:n+1},r._id))})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:w,className:"w-full px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700",children:"Submit"})})]})]})}const re=({setShowSubmitWindow:s,setSubmittedProblems:l,code:u,currProblem:m,testCases:j,language:d,fetchResult:h,problemId:g,getLanguageId:v})=>{const[b,w]=x.useState(null),[N,r]=x.useState(!1),[n,a]=x.useState(!1),[i,o]=x.useState([]),{user:f}=D(t=>t.auth),{id:I}=V(),$=async()=>{var R;a(!0);const t=[];let c=0,p=0,_=0;for(const C of j)try{const J=(await T.post(`${M}/submissions?base64_encoded=false`,{source_code:u,language_id:v(d),stdin:C.input,cpu_time_limit:5,memory_limit:128e3},{headers:B})).data.token,k=await h(J),P=((R=k==null?void 0:k.stdout)==null?void 0:R.trim())||"",G=C.output.trim(),U=P===G;U&&c++,p+=parseFloat(k.time||0),_+=parseInt(k.memory||0),t.push({input:C.input,output:P,expected:G,passed:U,error:k.stderr||null})}catch(L){console.error("Test case error:",L),t.push({input:C.input,output:"",expected:C.output,passed:!1,error:"Execution failed"})}const y=p/j.length,E=_/j.length;try{const C=await T.post(`${O}/api/v3/review/submit`,{userId:f._id,testId:I,problemId:m._id,language:d,sourceCode:u,codeReview:{},passedTestCases:c,totalTestCases:j.length,executionTime:y,memoryUsed:E,problemId:g});l(L=>[...L,{pNo:m,id:C.data.submissionId}])}catch(C){console.error("Submission API error:",C)}o(t),a(!1)},z=()=>{r(!0),T.post(`${O}/api/v3/review/code`,{sourceCode:u}).then(t=>{const c=A(t.data.data);console.log(c),w(c)}).catch(t=>console.error(t)).finally(()=>r(!1))};function A(t){if(!t)return null;const c=t.replace(/```json\n?/,"").replace(/```$/,"");try{return JSON.parse(c)}catch(p){return console.error("Failed to parse cleaned JSON:",p),null}}x.useEffect(()=>{$(),z()},[]);const S=(t,c,p=6)=>{const _=c>=p;return e.jsxs("div",{className:`flex justify-between items-center px-4 py-2 rounded text-sm font-medium ${_?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[e.jsx("span",{children:t}),e.jsxs("span",{children:[c,"/10 ",_?"✅":"❌"]})]})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 overflow-auto",children:e.jsxs("div",{className:"bg-white relative text-black p-6 rounded-xl shadow-2xl w-[90%] max-w-3xl max-h-[90vh] overflow-y-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Code Submission Report"}),e.jsx(F,{onClick:()=>s(!1),size:"small",children:e.jsx(Z,{})})]}),N||n?e.jsx("div",{className:"flex justify-center py-6",children:e.jsx("div",{className:"loader3"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Test Case Results"}),i.map((t,c)=>e.jsxs("div",{className:`border-l-4 p-4 rounded shadow-sm ${t.passed?"border-green-500 bg-green-50":"border-red-500 bg-red-50"}`,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Input:"})," ",e.jsx("pre",{className:"inline",children:t.input})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Expected:"})," ",e.jsx("pre",{className:"inline",children:t.expected})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Your Output:"})," ",e.jsx("pre",{className:"inline",children:t.output})]}),e.jsxs("p",{className:"mt-1 text-sm font-semibold",children:["Result: ",t.passed?e.jsx("span",{className:"text-green-700",children:"✅ Passed"}):e.jsx("span",{className:"text-red-700",children:"❌ Failed"})]}),t.error&&e.jsxs("p",{className:"text-xs text-red-500 mt-1",children:["Error: ",t.error]})]},c))]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Gemini Code Review"}),b?e.jsxs("div",{className:"space-y-2",children:[S("Indentation",b.indentation),S("Modularity",b.modularity),S("Variable Naming",b.variable_name_convention),S("Time Complexity",b.time_complexity),S("Space Complexity",b.space_complexity)]}):e.jsx("div",{className:"text-gray-500 text-sm",children:"Code review not available."})]})]})]})})};function Y(s){return s.replace(/\\n/g,`
`)}const W=s=>({cpp:54,c:50,java:62,python:71})[s]||71;function ie({currProblem:s,submittedProblems:l,problem:u,currSetting:m,setCurrentSection:j,setSubmittedProblems:d,handleCodeChange:h,handleLanguageChange:g}){const[v,b]=x.useState(m[s].language),[w,N]=x.useState(m[s].code),[r,n]=x.useState(!1),[a,i]=x.useState([]),[o,f]=x.useState();x.useEffect(()=>(l.includes(s)?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[s,l]),x.useEffect(()=>{const t=m[s];b(t.language),N(t.code),i([])},[s,m]);const I=t=>{N(t),h(s,t)},$=t=>{const c=t.target.value;window.confirm("Changing the language might reset your code. Proceed?")&&(b(c),g(s,c))},z=async t=>{var c;for(let p=0;p<10;p++)try{const y=(await T.get(`${M}/submissions/${t}?base64_encoded=false`,{headers:B})).data;if([3,4,6,11].includes((c=y.status)==null?void 0:c.id))return y;await new Promise(E=>setTimeout(E,2e3))}catch{return{stderr:"Failed to fetch result."}}return{stderr:"Timed out."}},A=async()=>{n(!0);const t=[];for(const c of u.sampleTestCases)try{const _=(await T.post(`${M}/submissions?base64_encoded=false`,{source_code:w,language_id:W(v),stdin:c.input,cpu_time_limit:5,memory_limit:128e3},{headers:B})).data.token,y=await z(_),E=y!=null&&y.stdout?y.stdout.trim():"",R=c.output.trim();t.push({input:c.input,output:E,expected:R,passed:E===R,error:y.stderr||null})}catch(p){console.error("Test case error:",p),t.push({input:c.input,output:"",expected:c.output,passed:!1,error:"Execution failed"})}i(t),n(!1)},S=()=>{u.id,window.confirm("Are you sure you want to submit the code?")&&(window.scrollTo({top:0,behavior:"smooth"}),f(!0))};return u?e.jsxs(e.Fragment,{children:[l.some(t=>t.pNo===s)&&e.jsx("div",{className:"fixed inset-0 top-[140px] bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-40",children:e.jsxs("div",{className:"bg-white text-black p-6 rounded shadow-lg text-center",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Submission Notice"}),e.jsx("p",{children:"You have already submitted this problem."})]})}),e.jsx("section",{className:"p-5",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-semibold",children:[e.jsx("strong",{children:"Problem:"})," ",u.title]}),e.jsxs("p",{className:"mb-4",children:[e.jsx("strong",{children:"Description:"})," ",u.description]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold mb-2",children:"Example"}),u.sampleTestCases.map((t,c)=>{const p=a[c];return e.jsxs("div",{className:"mb-6 border rounded p-4 bg-gray-50",children:[e.jsxs("div",{className:"mb-2 flex justify-between items-center",children:[e.jsxs("strong",{children:["Test Case #",c+1]}),p&&e.jsx("span",{className:`font-semibold ${p.passed?"text-green-600":"text-red-600"}`,children:p.passed?"✅ Passed":"❌ Failed"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Input:"}),e.jsx("pre",{className:"bg-white p-2 border rounded whitespace-pre-wrap",children:Y(t.input)})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Expected Output:"}),e.jsx("pre",{className:"bg-white p-2 border rounded whitespace-pre-wrap",children:t.output})]}),p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Your Output:"}),e.jsx("pre",{className:"bg-white p-2 border rounded whitespace-pre-wrap",children:p.output||"No output"})]}),p.error&&e.jsxs("div",{className:"text-red-500",children:[e.jsx("strong",{children:"Error:"})," ",p.error]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Explanation:"}),e.jsx("p",{className:"mt-1",children:t.explanation})]})]},c)})]})]})}),e.jsxs("div",{className:"mb-10",children:[e.jsxs("div",{className:"bg-gray-50 flex justify-between p-5 mx-5 rounded-t-lg",children:[e.jsxs("div",{className:"flex flex-col w-[100px] ml-1",children:[e.jsx("label",{className:"text-xs mb-1",children:"Choose language"}),e.jsxs("select",{value:v,onChange:$,className:"custominput",children:[e.jsx("option",{value:"cpp",children:"C++"}),e.jsx("option",{value:"c",children:"C"}),e.jsx("option",{value:"java",children:"Java"}),e.jsx("option",{value:"python",children:"Python"})]})]}),e.jsxs("div",{className:"flex justify-end flex-1 items-center gap-2",children:[e.jsx("button",{onClick:A,className:"rounded-md border border-slate-300 py-2 px-4 text-sm transition-all shadow-sm hover:shadow-lg text-white bg-slate-800 disabled:opacity-50",type:"button",disabled:r,children:r?"Running...":"Run Code"}),e.jsx("button",{onClick:S,className:"rounded-md border border-slate-300 py-2 px-4 text-sm transition-all shadow-sm hover:shadow-lg text-white bg-slate-800",type:"button",children:"Submit"})]})]}),e.jsx("div",{className:"bg-gray-50 shadow-lg border mx-5 custom-scrollbar",children:e.jsx(K,{height:"400px",language:v,value:w,onChange:I,options:{theme:"light",minimap:{enabled:!1},fontSize:14}})})]}),(r||a.length>0)&&e.jsx(oe,{isExecuting:r,testResults:a,data:u==null?void 0:u.sampleTestCases}),o&&e.jsx(re,{problemId:u._id,setShowSubmitWindow:f,code:w,language:v,testCases:u.testCases,getLanguageId:W,fetchResult:z,currProblem:s,setSubmittedProblems:d})]}):e.jsx("p",{className:"p-5 text-red-500",children:"Problem not found"})}const oe=({isExecuting:s,code:l,data:u,testResults:m})=>e.jsx("div",{className:"grid grid-cols-4 gap-3 mx-5 w-full",children:u==null?void 0:u.map((j,d)=>{const h=m[d];return e.jsx("div",{className:"mb-6 border rounded p-4 bg-gray-50",children:s?e.jsxs("div",{className:"flex justify-center",children:[" ",e.jsx("div",{className:"loader3"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-2 flex justify- items-center",children:[e.jsxs("strong",{children:["Test Case #",d+1]}),h&&e.jsx("span",{className:`font-semibold ${h.passed?"text-green-600":"text-red-600"}`,children:h.passed?"✅ Passed":"❌ Failed"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Input:"}),e.jsx("pre",{className:"bg-white p-2 border rounded whitespace-pre-wrap",children:Y(j.input)})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Expected Output:"}),e.jsx("pre",{className:"bg-white p-2 border rounded whitespace-pre-wrap",children:j.output})]}),h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Your Output:"}),e.jsx("pre",{className:"bg-white p-2 border rounded whitespace-pre-wrap",children:h.output||"No output"})]}),h.error&&e.jsxs("div",{className:"text-red-500",children:[e.jsx("strong",{children:"Error:"})," ",h.error]})]})]})},d)})});function le({test:s,currSection:l,testSubmission:u}){const[m,j]=x.useState(0),[d,h]=x.useState([]),{user:g}=D(n=>n.auth),[v,b]=x.useState(()=>s.sections[l].problemset.map((n,a)=>{var i;return{id:a,language:"cpp",code:((i=n.functionSignature.find(o=>o.language==="cpp"))==null?void 0:i.signature)||""}}));x.useEffect(()=>{(async()=>{try{const i=(await Promise.all(s==null?void 0:s.sections[l].problemset.map(o=>T.get(`${O}/api/v2/test/get/problem/response`,{params:{userId:g._id,problemId:o._id,testId:s._id},withCredentials:!0})))).map((o,f)=>o.data.exists?{pNo:f,id:o.data.id}:null).filter(o=>o!==null);h(i)}catch(a){console.error("Error fetching submissions:",a)}})()},[l,s._id,g._id,s==null?void 0:s.sections]),x.useEffect(()=>{b(n=>s.sections[l].problemset.map((a,i)=>{var o;return n[i]||{id:i,language:"cpp",code:((o=a.functionSignature.find(f=>f.language==="cpp"))==null?void 0:o.signature)||""}}))},[l,s.sections]);const w=(n,a)=>{b(i=>{const o=[...i];return o[n]={...o[n],code:a},o})},N=(n,a)=>{b(i=>{const o=[...i],f=o[n],I=s.sections[l].problemset[n].functionSignature.find($=>$.language===a);return o[n]={...f,language:a,code:(I==null?void 0:I.signature)||""},o})},r=async()=>{try{await T.post(`${O}/api/v2/test/submit-section/${u._id}`,{sectionId:s.sections[l]._id,sectionType:s.sections[l].sectionType,codingAnswers:d},{withCredentials:!0}),window.location.reload()}catch(n){console.error("Submit error:",n)}};return e.jsxs(e.Fragment,{children:[d.length===s.sections[l].problemset.length&&e.jsx("div",{className:"fixed flex w-full justify-end pr-20 mt-4",children:e.jsx(q,{onClick:r,variant:"contained",sx:{bgcolor:"#000"},children:"Submit"})}),e.jsx("div",{className:"flex flex-wrap gap-3 px-5 py-4 bg-white shadow-sm rounded-md mb-4",children:s.sections[l].problemset.map((n,a)=>{const i=d.some(f=>(f==null?void 0:f.pNo)===a),o=a===m;return e.jsx("button",{onClick:()=>{i||j(a)},disabled:i,className:`px-4 py-2 rounded-lg text-sm font-medium transition duration-200 border
                ${i?"bg-green-500 text-white border-green-600 cursor-not-allowed":""}
                ${!i&&o?"bg-orange-500 text-white border-orange-600 shadow-md":""}
                ${!i&&!o?"bg-gray-100 text-gray-800 hover:bg-gray-200 border-gray-300":""}
              `,title:i?"Already submitted":"Click to open",children:n.title},a)})}),e.jsx(ie,{currProblem:m,submittedProblems:d,problem:s.sections[l].problemset[m],currSetting:v,setSubmittedProblems:h,setCurrentSection:b,handleCodeChange:w,handleLanguageChange:N})]})}function ge({userId:s,testSubmission:l,testId:u,currSection:m,setCurrentSection:j,test:d}){var r;const[h,g]=x.useState(0),{user:v}=D(n=>n.auth),[b,w]=x.useState(!1);x.useEffect(()=>{if(d&&l){const a=new Date(l.startedAt).getTime()+d.duration*60*1e3,i=setInterval(()=>{const o=a-Date.now();g(Math.max(o,0)),o<=0&&(clearInterval(i),N())},1e3);return()=>clearInterval(i)}},[l,d]);const N=()=>{console.log("Time's up! Submitting test...")};return l.isSubmitted?e.jsx(e.Fragment,{children:"Quiz has been submitted view Response in home section"}):e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"flex gap-8 relative h-[70px] items-center left-0 shadow-sm w-full p-4",children:e.jsxs("nav",{className:"flex gap-8 fixed h-[70px] z-20 justify-between bg-white left-0 top-0 items-center shadow-sm w-full p-4",children:[e.jsx("div",{className:"flex items-center gap-5",children:e.jsx("img",{src:X,className:"h-9",alt:"Logo"})}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("p",{children:"Time left"}),h>0?e.jsxs("div",{className:"flex gap-4 items-center px-3 p-1 bg-orange-500 text-gray-900 rounded-sm shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2 text-md ",children:[e.jsx("span",{className:"text-lg animate-pulse"}),Math.floor(h/6e4)," m"]}),e.jsx(ee,{orientation:"vertical",flexItem:!0,className:"border-gray-300"}),e.jsxs("div",{className:"flex items-center gap-2 text-md ",children:[e.jsx("span",{className:"text-lg animate-pulse",children:" "}),Math.floor(h%6e4/1e3)," s"]})]}):e.jsx("span",{className:"text-red-500 font-bold",children:"Time's Up! Submitting..."})]})]})}),e.jsx("div",{className:"flex fixed justify-end right-0  pt-4 px-4   z-50 ",children:e.jsx(F,{onClick:()=>{w(!0)},color:"primary",children:e.jsx(H,{})})}),e.jsxs("div",{className:`fixed ${b?"":"translate-x-full"} top-[70px] transition-all duration-50 ease-linear right-0 bg-gray-50 p-5 w-[200px] h-[calc(100vh-70px)] z-50 flex flex-col gap-5`,children:[e.jsx("div",{className:"flex  justify-start",children:e.jsx(F,{onClick:()=>{w(!1)},children:e.jsx(se,{})})}),d==null?void 0:d.sections.map((n,a)=>{const i=a===m,o=a<m,f=a>m;return e.jsxs("div",{className:`py-3 text-sm w-full rounded-lg flex justify-between items-center px-3 cursor-pointer transition duration-300
              ${i?"bg-blue-500 text-white":"bg-orange-400 text-white hover:bg-orange-500"}
            `,children:[e.jsx("span",{children:n.name}),o&&e.jsx(ne,{fontSize:"small",className:"text-white"}),f&&e.jsx(te,{fontSize:"small",className:"text-gray-200"})]},a)})]}),d.sections[m].sectionType=="Quiz"?e.jsx(ae,{testSubmissionId:l._id,sectionId:d.sections[m]._id,questionSet:(r=d.sections[m])==null?void 0:r.questionSet}):e.jsx(le,{testSubmission:l,currSection:m,test:d})]})}export{ge as default};

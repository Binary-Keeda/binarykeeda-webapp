import{j as e,r as u,a as I,B as A,c as E,e as te,C as F,o as O,f as ie,L as W}from"./index-DFFB5JpH.js";import{B as L}from"./Button-BhLQaCKh.js";import{M as Q}from"./Modal-BJywLYtj.js";import{B as G}from"./Box-Bl1unST0.js";import{T as z}from"./Typography-sG4yEUcK.js";import{d as ae}from"./index-cywpPICr.js";import{I as ne}from"./IconButton-BSWRmrCo.js";import{C as re}from"./Close-DOyBf1TG.js";import{c as D}from"./createSvgIcon-DGcWleu0.js";import{C as le}from"./CircularProgress-CIW2s6kt.js";import{f as oe,s as H,e as de,c as ce,m as J,o as me}from"./createSimplePaletteValueFilter-B1PeVHaH.js";import{g as xe}from"./dividerClasses-ClX7rMQc.js";import{S as pe}from"./ShortText-BEqV7yBe.js";import{L as he}from"./Lock-6VpePt6u.js";import"./ButtonBase-BVZ8QZNp.js";import"./Portal-BHD7psnX.js";import"./useSlot-CK59g3ok.js";import"./index-Dhk4OUKr.js";const K=D(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),ue=D(e.jsx("path",{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"}),"NavigateBefore"),ge=D(e.jsx("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),"NavigateNext"),fe=s=>{const{absolute:t,children:a,classes:n,flexItem:o,light:r,orientation:l,textAlign:g,variant:v}=s;return ce({root:["root",t&&"absolute",v,r&&"light",l==="vertical"&&"vertical",o&&"flexItem",a&&"withChildren",a&&l==="vertical"&&"withChildrenVertical",g==="right"&&l!=="vertical"&&"textAlignRight",g==="left"&&l!=="vertical"&&"textAlignLeft"],wrapper:["wrapper",l==="vertical"&&"wrapperVertical"]},xe,n)},be=H("div",{name:"MuiDivider",slot:"Root",overridesResolver:(s,t)=>{const{ownerState:a}=s;return[t.root,a.absolute&&t.absolute,t[a.variant],a.light&&t.light,a.orientation==="vertical"&&t.vertical,a.flexItem&&t.flexItem,a.children&&t.withChildren,a.children&&a.orientation==="vertical"&&t.withChildrenVertical,a.textAlign==="right"&&a.orientation!=="vertical"&&t.textAlignRight,a.textAlign==="left"&&a.orientation!=="vertical"&&t.textAlignLeft]}})(J(({theme:s})=>({margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(s.vars||s).palette.divider,borderBottomWidth:"thin",variants:[{props:{absolute:!0},style:{position:"absolute",bottom:0,left:0,width:"100%"}},{props:{light:!0},style:{borderColor:s.vars?`rgba(${s.vars.palette.dividerChannel} / 0.08)`:me(s.palette.divider,.08)}},{props:{variant:"inset"},style:{marginLeft:72}},{props:{variant:"middle",orientation:"horizontal"},style:{marginLeft:s.spacing(2),marginRight:s.spacing(2)}},{props:{variant:"middle",orientation:"vertical"},style:{marginTop:s.spacing(1),marginBottom:s.spacing(1)}},{props:{orientation:"vertical"},style:{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"}},{props:{flexItem:!0},style:{alignSelf:"stretch",height:"auto"}},{props:({ownerState:t})=>!!t.children,style:{display:"flex",textAlign:"center",border:0,borderTopStyle:"solid",borderLeftStyle:"solid","&::before, &::after":{content:'""',alignSelf:"center"}}},{props:({ownerState:t})=>t.children&&t.orientation!=="vertical",style:{"&::before, &::after":{width:"100%",borderTop:`thin solid ${(s.vars||s).palette.divider}`,borderTopStyle:"inherit"}}},{props:({ownerState:t})=>t.orientation==="vertical"&&t.children,style:{flexDirection:"column","&::before, &::after":{height:"100%",borderLeft:`thin solid ${(s.vars||s).palette.divider}`,borderLeftStyle:"inherit"}}},{props:({ownerState:t})=>t.textAlign==="right"&&t.orientation!=="vertical",style:{"&::before":{width:"90%"},"&::after":{width:"10%"}}},{props:({ownerState:t})=>t.textAlign==="left"&&t.orientation!=="vertical",style:{"&::before":{width:"10%"},"&::after":{width:"90%"}}}]}))),je=H("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(s,t)=>{const{ownerState:a}=s;return[t.wrapper,a.orientation==="vertical"&&t.wrapperVertical]}})(J(({theme:s})=>({display:"inline-block",paddingLeft:`calc(${s.spacing(1)} * 1.2)`,paddingRight:`calc(${s.spacing(1)} * 1.2)`,whiteSpace:"nowrap",variants:[{props:{orientation:"vertical"},style:{paddingTop:`calc(${s.spacing(1)} * 1.2)`,paddingBottom:`calc(${s.spacing(1)} * 1.2)`}}]}))),B=u.forwardRef(function(t,a){const n=oe({props:t,name:"MuiDivider"}),{absolute:o=!1,children:r,className:l,orientation:g="horizontal",component:v=r||g==="vertical"?"div":"hr",flexItem:y=!1,light:p=!1,role:w=v!=="hr"?"separator":void 0,textAlign:b="center",variant:x="fullWidth",...j}=n,d={...n,absolute:o,component:v,flexItem:y,light:p,orientation:g,role:w,textAlign:b,variant:x},m=fe(d);return e.jsx(be,{as:v,className:de(m.root,l),role:w,ref:a,ownerState:d,"aria-orientation":w==="separator"&&(v!=="hr"||g==="vertical")?g:void 0,...j,children:r?e.jsx(je,{className:m.wrapper,ownerState:d,children:r}):null})});B&&(B.muiSkipListHighlight=!0);function ve({questionSet:s=[],sectionId:t,testSubmissionId:a}){var h;const[n,o]=u.useState(0),[r,l]=u.useState({}),[g,v]=u.useState(new Set),[y,p]=u.useState(!1),[w,b]=u.useState(!1),x=s[n];u.useEffect(()=>{x!=null&&x._id&&v(i=>new Set(i).add(x._id))},[n,x]);const j=(i,c)=>{l(C=>({...C,[i]:c}))},d=i=>{var _;const c=((_=s[n])==null?void 0:_._id)===i,C=r[i],S=g.has(i);let T="p-2 border text-sm";return c?`${T} bg-blue-700 text-white border-blue-700`:C?`${T} bg-green-100 border-green-400 text-green-800`:S?`${T} bg-orange-100 border-orange-400 text-orange-800`:`${T} bg-red-100 border-red-400 text-red-800`},m=()=>{b(!1),p(!0),I.post(`${A}/api/v2/test/submit-section/${a}`,{sectionId:t,sectionType:"Quiz",quizAnswers:r},{withCredentials:!0}).then(()=>{b(!1),window.location.reload()}).catch(i=>{console.log(i),p(!1)})};return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-52px-70px)] lg:flex-row font-sans bg-white text-gray-800",children:[e.jsxs("div",{className:"flex-1 flex-col justify-between flex h-full p-5",children:[e.jsxs("div",{className:"border w-full border-gray-200 rounded-sm p-8 shadow-sm",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-2",children:["Question ",n+1," of ",s.length]}),e.jsx("p",{className:"text-base",children:x==null?void 0:x.question})]}),e.jsx("div",{className:"space-y-4",children:(h=x==null?void 0:x.answerOptions)==null?void 0:h.map(i=>{const c=r[x._id]==i._id;return e.jsxs("label",{className:`flex items-center border p-3 rounded-md cursor-pointer transition ${c?"border-blue-600 bg-blue-50":"border-gray-300"}`,children:[e.jsx("input",{type:"radio",className:"mr-3",name:`question-${x._id}`,value:i._id,checked:c,onChange:()=>j(x._id,i._id)}),e.jsx("span",{className:"text-sm",children:i.text})]},i._id)})})]}),e.jsxs("div",{className:"mt-8 justify-end flex items-center gap-4",children:[e.jsx("button",{onClick:()=>o(i=>Math.max(i-1,0)),disabled:n===0,className:"px-4 py-2 border rounded-md text-sm bg-[#1876d2] text-white disabled:opacity-50",children:"Previous"}),e.jsx("button",{onClick:()=>o(i=>Math.min(i+1,s.length-1)),disabled:n===s.length-1,className:"px-4 py-2 border rounded-md text-sm bg-[#1876d2] text-white disabled:opacity-50",children:"Next"})]})]}),e.jsx("div",{className:"w-full h-full lg:w-1/4 border-t lg:border-t-0 lg:border-l border-gray-200 p-6 bg-white flex flex-col justify-between",children:e.jsxs("div",{className:"w-full h-full flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold mb-4",children:"Question Navigator"}),e.jsx("div",{className:"grid grid-cols-6 gap-2 lg:grid-cols-5",children:s.map((i,c)=>e.jsx("button",{onClick:()=>o(c),className:`${d(i._id)} rounded-full h-[40px] w-[40px]`,children:c+1},i._id))}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Color Legend"}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 rounded-sm bg-blue-700 inline-block"}),e.jsx("span",{children:"Current Question"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 rounded-sm bg-green-100 border border-green-400 inline-block"}),e.jsx("span",{children:"Attempted"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 rounded-sm bg-orange-100 border border-orange-400 inline-block"}),e.jsx("span",{children:"Seen but Unattempted"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 rounded-sm bg-red-100 border border-red-400 inline-block"}),e.jsx("span",{children:"Unseen"})]})]})]})]}),e.jsx(L,{onClick:()=>b(!0),variant:"contained",color:"primary",fullWidth:!0,disabled:y,children:"Submit"})]})}),e.jsx(Q,{open:w,onClose:()=>b(!1),"aria-labelledby":"submit-confirm-title","aria-describedby":"submit-confirm-description",children:e.jsxs(G,{className:"absolute bg-white p-6 rounded-md shadow-lg",sx:{top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:600},children:[e.jsx(z,{id:"submit-confirm-title",variant:"h6",component:"h2",className:"mb-4",children:"Confirm Submission"}),e.jsx(z,{id:"submit-confirm-description",className:"mb-4 text-sm text-gray-700",children:"Are you sure you want to submit your quiz? You won't be able to change your answers later."}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(L,{onClick:()=>b(!1),variant:"outlined",children:"Cancel"}),e.jsx(L,{onClick:m,variant:"contained",color:"primary",children:"Confirm"})]})]})})]})}function we({setShowOutputWindow:s,codeReview:t,testResults:a,summary:n,isExecuting:o}){const r=(l,g,v=6)=>{const y=g>=1;return e.jsxs("div",{className:`flex justify-between items-center px-4 py-2 rounded text-sm font-medium ${y?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[e.jsx("span",{children:l}),e.jsx("span",{children:y?"Passed":"Failed"})]})};return e.jsx("div",{className:"absolute w-full left-0",children:e.jsxs("div",{className:"bg-white min-h-[calc(100vh-52px-60px)] relative text-black p-6 rounded-3xl shadow-2xl w-[100%] max-w-3xl max-h-[90vh] overflow-y-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Output Window"}),e.jsx(ne,{onClick:()=>s(!1),size:"small",children:e.jsx(re,{})})]}),o||a.length==0?e.jsx("div",{className:"flex justify-center py-6",children:e.jsx("div",{className:"h-full w-full flex justify-center pt-5",children:e.jsx("div",{className:"spinner"})})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Test Case Results"," ",e.jsxs("span",{className:"text-sm font-normal text-gray-600",children:["(",n==null?void 0:n.passed,"/",parseInt(n==null?void 0:n.passed)+parseInt(n==null?void 0:n.failed)," Passed)"]})]}),a.slice(0,2).map((l,g)=>e.jsxs("div",{className:`border-l-4 p-4 rounded shadow-sm ${l.passed?"border-green-500 bg-green-50":"border-red-500 bg-red-50"}`,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Input:"})," ",e.jsx("pre",{className:"inline",children:l.input})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Expected:"})," ",e.jsx("pre",{className:"inline",children:l.expected})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Your Output:"})," ",e.jsx("pre",{className:"inline",children:l.output})]}),e.jsxs("p",{className:"mt-1 text-sm font-semibold",children:["Result:"," ",l.passed?e.jsx("span",{className:"text-green-700",children:"✅ Passed"}):e.jsx("span",{className:"text-red-700",children:"❌ Failed"})]}),l.error&&e.jsxs("p",{className:"text-xs text-red-500 mt-1",children:["Error: ",l.error]})]},g)),a.length>2&&e.jsx("div",{className:"text-sm text-gray-500 italic",children:"Only first 2 test cases are shown."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"AI Code Review"}),t?e.jsxs("div",{className:"space-y-2",children:[r("Indentation",t.indentation),r("Modularity",t.modularity),r("Variable Naming",t.variable_name_convention),r("Time Complexity",t.time_complexity),r("Space Complexity",t.space_complexity),r("Final",t.finalScore)]}):e.jsx("div",{className:"text-gray-500 text-sm",children:"Code review not available."})]})]})]})})}const P=s=>typeof s=="string"?btoa(unescape(encodeURIComponent(s))):"",R=s=>typeof s=="string"?decodeURIComponent(escape(atob(s))):"",U=async({code:s,language:t,testCases:a,setIsExecuting:n,setSummary:o,setTestResults:r,headers:l,CODE_EXECUTION_API:g,getLanguageId:v})=>{n(!0);const y=[];let p=0,w=0,b=0;try{const x=a.map(c=>({source_code:P(s),language_id:v(t),stdin:P(c.input),cpu_time_limit:5,memory_limit:128e3})),d=(await I.post(`${g}/submissions/batch?base64_encoded=true&wait=false`,{submissions:x},{headers:l})).data||[];(await ye(d,g,l)).forEach((c,C)=>{const S=a[C],T=c.stdout,_=S.output.trim(),$=T===_,k=c.stderr||c.compile_error||"";$&&p++,w+=parseFloat(c.time||0),b+=parseInt(c.memory||0),y.push({input:S.input,output:T,expected:_,passed:$,error:k})});const h=w/a.length,i=b/a.length;o({passed:p,failed:a.length-p,total:a.length,avgTime:h.toFixed(3),avgMemory:i.toFixed(2)}),r(y)}catch(x){console.error("Batch execution error:",x)}finally{n(!1)}},ye=async(s,t,a)=>{const r=s.map(l=>typeof l=="string"?l:l.token);for(let l=0;l<10;l++)try{const v=(await I.get(`${t}/submissions/batch?tokens=${r.join(",")}&base64_encoded=true`,{headers:a})).data.submissions;if(v.every(p=>{var w;return[3,4,6,11].includes((w=p.status)==null?void 0:w.id)}))return v.map(p=>({stdout:p.stdout?R(p.stdout).trim():"",stderr:p.stderr?R(p.stderr).trim():"",compile_error:p.compile_output?R(p.compile_output).trim():"",time:p.time||"0",memory:p.memory||"0",status:p.status}));await new Promise(p=>setTimeout(p,2e3))}catch(g){return console.error("Batch fetch error:",g),r.map(()=>({stdout:"",stderr:"Failed to fetch result.",compile_error:"",time:"0",memory:"0",status:{id:-1,description:"Fetch error"}}))}return r.map(()=>({stdout:"",stderr:"Timed out.",compile_error:"",time:"0",memory:"0",status:{id:-2,description:"Timed out"}}))};function Ne(s){if(!s)return null;const t=s.replace(/```json\n?/,"").replace(/```$/,"");try{return JSON.parse(t)}catch(a){return console.error("Failed to parse cleaned JSON:",a),null}}const V=async({code:s,setCodeReview:t,problemName:a})=>{I.post(`${A}/api/v3/review/code`,{sourceCode:s,problem:a}).then(n=>{const o=Ne(n.data.data);return t(o),o}).catch(n=>console.error(n))},Y=s=>({cpp:54,c:50,java:62,python:71})[s]||71;function Ce({setCurrProblem:s,totalQuestion:t,currProblem:a,submittedProblems:n,problem:o,currSetting:r,setCurrentSection:l,setSubmittedProblems:g,handleCodeChange:v,handleLanguageChange:y}){const{user:p}=E(f=>f.auth),{id:w}=te(),[b,x]=u.useState(r[a].language),[j,d]=u.useState(r[a].code),[m,h]=u.useState(!1),[i,c]=u.useState(),[C,S]=u.useState([]),[T,_]=u.useState(!1),[$,k]=u.useState(),[X,M]=u.useState(!1);u.useEffect(()=>(n.includes(a)?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[a,n]),u.useEffect(()=>{const f=r[a];x(f.language),d(f.code)},[a,r]);const Z=f=>{d(f),v(a,f)},q=f=>{const N=f.target.value;window.confirm("Changing the language might reset your code. Proceed?")&&(x(N),y(a,N))},ee=async()=>{_(!0),S([]),c([]),k(),await U({code:j,language:b,testCases:o.testCases,setIsExecuting:h,setSummary:c,setTestResults:S,headers:O,CODE_EXECUTION_API:F,getLanguageId:Y}),await V({setCodeReview:k,code:j,problemName:o.title})},se=async()=>{_(!0),M(!1),S([]),c([]),k([]);try{await U({code:j,language:b,testCases:o.testCases,setIsExecuting:h,setSummary:c,setTestResults:S,headers:O,CODE_EXECUTION_API:F,getLanguageId:Y}),await V({setCodeReview:k,code:j,problemName:o.title});const f=await I.post(`${A}/api/v3/review/submit`,{userId:p._id,testId:w,problemId:o._id,language:b,sourceCode:j,codeReview:$,passedTestCases:(i==null?void 0:i.passed)||0,totalTestCases:(i==null?void 0:i.total)||0,executionTime:i==null?void 0:i.avgTime,memoryUsed:i==null?void 0:i.avgMemory});g(N=>[...N,{pNo:a,id:f.data.submissionId}]),setTimeout(()=>{_(!1),s(N=>(N+1)%t)},3e3)}catch(f){console.error("Submission API error:",f)}};return o?e.jsx(e.Fragment,{children:e.jsxs("section",{className:"p-5  h-[calc(100vh-60px-52px)]  overflow-x-hidden overflow-y-hidden left-0  relative flex w-[calc(100vw-70px)]",children:[e.jsxs("div",{className:"flex-[0.6] relative min-w-[200px] custom-scrollbar overflow-y-hidden",children:[e.jsxs("div",{className:"flex-[0.4] overflow-y-scroll h-full p-4 space-y-4 text-sm",children:[e.jsx("h1",{className:"text-2xl font-bold",children:o.title}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Description"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-line",children:o.description})]}),o.constraints&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Constraints"}),e.jsx("ul",{className:"list-disc list-inside text-gray-600",children:o.constraints.map((f,N)=>e.jsx("li",{children:f},N))})]}),o.topics&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Topics"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:o.topics.map((f,N)=>e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded",children:f},N))})]}),o.hints&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Hints"}),e.jsx("ul",{className:"list-disc list-inside text-gray-600",children:o.hints.map((f,N)=>e.jsx("li",{children:f},N))})]}),o.sampleTestCases&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Sample Test Cases"}),o.sampleTestCases.map((f,N)=>e.jsxs("div",{className:"mb-2 p-2 bg-gray-100 rounded",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Input:"})," ",f.input]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Output:"})," ",f.output]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Explanation:"})," ",f.explanation]})]},N))]})]}),e.jsx("div",{className:`absolute w-full h-[] top-0 transition-all duration-300 ease-linear  ${T?"top-0":"top-[100vh] invisible "}`,children:T&&e.jsx(e.Fragment,{children:e.jsx(we,{codeReview:$,setShowOutputWindow:_,testResults:C,summary:i})})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("hr",{className:"bg-gray-300  flex-1 w-[2px]"}),e.jsxs("div",{className:"hover:bg-blue-500 hover:text-white cursor-grab bg-gray-300 h-[25px] w-[25px] flex items-center  rounded-full",children:[e.jsx(ue,{sx:{marginRight:"-3px"},fontSize:"12"}),e.jsx(ge,{sx:{marginLeft:"-3px"},fontSize:"12"})]}),e.jsx("hr",{className:"bg-gray-300 flex-1 w-[2px]"})]}),e.jsxs("div",{className:"mb-10 relative flex-1",children:[n.some(f=>f.pNo===a)&&e.jsx("div",{className:"absolute h-full w-full inset-0  bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-10",children:e.jsxs("div",{className:"bg-white text-black p-6 rounded shadow-lg text-center",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Submission Notice"}),e.jsx("p",{children:"You have already submitted this problem."})]})}),e.jsxs("div",{className:"bg-gray-50 flex justify-between p-5 mx-5 rounded-t-lg",children:[e.jsxs("div",{className:"flex flex-col  ml-1",children:[e.jsx("label",{className:"text-xs mb-1",children:"Choose language"}),e.jsxs("select",{value:b,onChange:q,className:"custominput",children:[e.jsx("option",{value:"cpp",children:"C++"}),e.jsx("option",{value:"c",children:"C"}),e.jsx("option",{value:"java",children:"Java"}),e.jsx("option",{value:"python",children:"Python"})]})]}),e.jsxs("div",{className:"flex justify-end flex-1 items-center gap-2",children:[e.jsx("button",{onClick:ee,className:"rounded-md border border-slate-300 py-2 px-4 text-sm transition-all shadow-sm hover:shadow-lg text-white bg-slate-800 disabled:opacity-50",type:"button",disabled:m,children:m?"Running...":"Run Code"}),e.jsx("button",{onClick:()=>M(!0),className:"rounded-md border border-slate-300 py-2 px-4 text-sm transition-all shadow-sm hover:shadow-lg text-white bg-slate-800",type:"button",children:"Submit"})]})]}),e.jsx("div",{className:"bg-gray-50 shadow-lg border mx-5 custom-scrollbar",children:e.jsx(ae,{height:"550px",language:b,value:j,onChange:Z,options:{theme:"light",minimap:{enabled:!1},fontSize:14}})})]}),e.jsx(Q,{open:X,onClose:()=>M(!1),"aria-labelledby":"submit-confirm-title","aria-describedby":"submit-confirm-description",children:e.jsxs(G,{className:"absolute bg-white p-6 rounded-md shadow-lg",sx:{top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:600},children:[e.jsx(z,{id:"submit-confirm-title",variant:"h6",component:"h2",className:"mb-4",children:"Confirm Submission"}),e.jsx(z,{id:"submit-confirm-description",className:"mb-4 text-sm text-gray-700",children:"Are you sure you want to submit your code ? You won't be able to change your solution later."}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(L,{onClick:()=>M(!1),variant:"outlined",children:"Cancel"}),e.jsx(L,{onClick:se,variant:"contained",color:"primary",children:"Confirm"})]})]})})]})}):e.jsx("p",{className:"p-5 text-red-500",children:"Problem not found"})}function Se({test:s,currSection:t,testSubmission:a}){const[n,o]=u.useState(0),[r,l]=u.useState([]),{user:g}=E(d=>d.auth),[v,y]=u.useState(),[p,w]=u.useState(()=>s.sections[t].problemset.map((d,m)=>{var h;return{id:m,language:"cpp",code:((h=d.functionSignature.find(i=>i.language==="cpp"))==null?void 0:h.signature)||""}}));u.useEffect(()=>{(async()=>{try{const h=(await Promise.all(s==null?void 0:s.sections[t].problemset.map(i=>I.get(`${A}/api/v2/test/get/problem/response`,{params:{userId:g._id,problemId:i._id,testId:s._id},withCredentials:!0})))).map((i,c)=>i.data.exists?{pNo:c,id:i.data.id}:null).filter(i=>i!==null);l(h)}catch(m){console.error("Error fetching submissions:",m)}})()},[t,s._id,g._id,s==null?void 0:s.sections]),u.useEffect(()=>{w(d=>s.sections[t].problemset.map((m,h)=>{var i;return d[h]||{id:h,language:"cpp",code:((i=m.functionSignature.find(c=>c.language==="cpp"))==null?void 0:i.signature)||""}}))},[t,s.sections]);const b=(d,m)=>{w(h=>{const i=[...h];return i[d]={...i[d],code:m},i})},x=(d,m)=>{w(h=>{const i=[...h],c=i[d],C=s.sections[t].problemset[d].functionSignature.find(S=>S.language===m);return i[d]={...c,language:m,code:(C==null?void 0:C.signature)||""},i})},j=async()=>{try{y(!0),await I.post(`${A}/api/v2/test/submit-section/${a._id}`,{sectionId:s.sections[t]._id,sectionType:s.sections[t].sectionType,codingAnswers:r},{withCredentials:!0}),window.location.reload()}catch(d){console.error("Submit error:",d)}finally{y(!1)}};return u.useEffect(()=>{r.length==s.sections[t].problemset.length&&j()},[r]),e.jsxs(e.Fragment,{children:[r.length===s.sections[t].problemset.length&&e.jsx("div",{className:"fixed top-[67px]  flex w-full justify-end pr-24",children:e.jsx(L,{disabled:v,onClick:j,variant:"contained",sx:{bgcolor:"#000"},children:v?e.jsx(le,{size:14}):"Submit"})}),e.jsx("div",{className:"fixed right-0 top-[70px] h-[calc(100vh-70px)] px-5 py-4 bg-gray-50 shadow-sm rounded-md mb-4",children:e.jsxs("div",{className:"relative flex flex-col items-center gap-6",children:[e.jsx("div",{className:"absolute top-0 bottom-0 left-1/2 w-[2px] bg-gray-400 z-0"}),s.sections[t].problemset.map((d,m)=>{const h=r.some(c=>(c==null?void 0:c.pNo)===m),i=m===n;return e.jsx("span",{onClick:()=>{h||o(m)},disabled:h,className:`relative border-gray-300 border-2 z-10 flex justify-center items-center h-[35px] w-[35px] rounded-full text-sm font-medium transition duration-200
            ${h?"bg-blue-500 text-white border-green-600 cursor-not-allowed":i?"bg-blue-500  text-white cursor-pointer shadow-md":"bg-gray-100 text-gray-800 cursor-pointer hover:bg-gray-200 border-gray-300"}
          `,title:h?"Already submitted":"Click to open",children:h?e.jsx(K,{fontSize:"small",className:"text-blue-400"}):m+1},m)})]})}),n<s.sections[t].problemset.length&&e.jsx(Ce,{totalQuestion:s.sections[t].problemset.length,setCurrProblem:o,currProblem:n,submittedProblems:r,problem:s.sections[t].problemset[n],currSetting:p,setSubmittedProblems:l,setCurrentSection:w,handleCodeChange:b,handleLanguageChange:x})]})}function Qe({userId:s,testSubmission:t,testId:a,currSection:n,setCurrentSection:o,test:r}){var b;const[l,g]=u.useState(0),{user:v}=E(x=>x.auth),[y,p]=u.useState(!1);u.useEffect(()=>{if(r&&t){const j=new Date(t.startedAt).getTime()+r.duration*60*1e3,d=setInterval(()=>{const m=j-Date.now();g(Math.max(m,0)),m<=0&&(clearInterval(d),w())},1e3);return()=>clearInterval(d)}},[t,r]);const w=()=>{console.log("Time's up! Submitting test...")};return t.isSubmitted?e.jsx(e.Fragment,{children:e.jsx(Te,{testSubmission:t})}):e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"flex gap-8 relative h-[60px] items-center left-0 shadow-sm w-full p-4",children:e.jsxs("nav",{className:"flex gap-8 fixed h-[60px] z-20 justify-between bg-white left-0 top-0 items-center shadow-sm w-full p-4",children:[e.jsx("div",{className:"flex items-center gap-5",children:e.jsx("img",{src:ie,className:"h-9",alt:"Logo"})}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("p",{children:"Time left"}),l>0?e.jsxs("div",{className:"flex gap-4 items-center px-3 p-1 bg-gray-300 text-gray-900 rounded-sm shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2 text-md ",children:[e.jsx("span",{className:"text-lg animate-pulse"}),Math.floor(l/6e4)," m"]}),e.jsx(B,{orientation:"vertical",flexItem:!0,className:"border-gray-300"}),e.jsxs("div",{className:"flex items-center gap-2 text-md ",children:[e.jsx("span",{className:"text-lg animate-pulse",children:" "}),Math.floor(l%6e4/1e3)," s"]})]}):e.jsx("span",{className:"text-red-500 font-bold",children:"Loading...."}),e.jsx("div",{className:"cursor-pointer",children:e.jsx(pe,{})})]})]})}),e.jsx("div",{className:"flex px-3 py-2 shadow-sm bg-gray-50 items-center gap-2",children:r==null?void 0:r.sections.map((x,j)=>{const d=j===n,m=j<n,h=j>n;return e.jsxs("div",{className:`w-[140px] py-2 px-3 rounded-lg shadow-sm text-sm flex justify-between items-center cursor-pointer transition duration-300
    ${d?"bg-blue-600 text-white":"bg-white hover:bg-blue-50 text-blue-800"}
  `,children:[e.jsx("span",{className:"mr-2 font-medium truncate",children:x.name}),e.jsxs("div",{className:"flex items-center gap-1",children:[m&&e.jsx(K,{fontSize:"small",className:"text-blue-400"}),h&&e.jsx(he,{fontSize:"small",className:"text-blue-200"})]})]},j)})}),r.sections[n].sectionType=="Quiz"?e.jsx(ve,{testSubmissionId:t._id,sectionId:r.sections[n]._id,questionSet:(b=r.sections[n])==null?void 0:b.questionSet}):e.jsx(Se,{testSubmission:t,currSection:n,test:r})]})}function Te({testSubmission:s}){return s!=null&&s.isSubmitted?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:e.jsxs("div",{className:"bg-white shadow-lg rounded-xl p-8 max-w-xl w-full text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-green-700 mb-4",children:"Test Submitted Successfully"}),e.jsxs("p",{className:"text-gray-700 text-base mb-6",children:["Your test response has been successfully recorded. ",e.jsx("br",{}),"You may review your answers in the ",e.jsx("span",{className:"font-medium text-blue-600",children:"Preview"})," section."]}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(W,{to:"/",children:e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-md text-sm transition-all",children:"Return to Home"})}),e.jsx(W,{to:"/user",children:e.jsx("button",{className:"bg-gray-200 hover:bg-gray-300 text-gray-800 px-5 py-2 rounded-md text-sm transition-all",children:"View Response"})})]})]})}):null}export{Qe as default};
